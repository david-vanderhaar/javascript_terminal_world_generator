import{s as We,n as fe,o as Ye,i as Ze}from"../chunks/scheduler.e108d1fd.js";import{S as Ce,i as He,s as ce,g as U,m as Q,y as Ve,f as z,c as he,h as F,j as ee,n as J,z as Ke,k as $,l as je,a as te,x as Y,A as Le,o as ue,B as Xe}from"../chunks/index.bbcc9712.js";const Ue=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ge(i){return(i==null?void 0:i.length)!==void 0?i:Array.from(i)}var v={};function me(){var i=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(i=!0)}(navigator.userAgent||navigator.vendor||window.opera),i}function ve(){if(me()){var i=window.innerWidth,e=window.innerHeight,t=Math.min(i,e),n=Math.max(i,e);return t<=480&&n<=896}else return!1}function Fe(){return v.DevicePointingAccuracy==null&&(B(),!re()&&!v.waitingForLoaded&&(v.waitingForLoaded=!0,window.addEventListener("DOMContentLoaded",B))),v.DeviceCanHover}function Z(i){var e=window.matchMedia||window.webkitMatchmedia||window.mozMatchmedia||window.oMatchmedia;return e!=null&&e(i).matches}function re(){return document.readyState==="interactive"||document.readyState==="complete"}function pe(){return v.AppRunsOnLegacyTouchDevice==null&&(v.AppRunsOnLegacyTouchDevice=!Z("(pointer:fine)")&&!Z("(pointer:coarse)")&&!Z("-moz-touch-enabled")&&("ontouchstart"in Window||(navigator.maxTouchPoints||0)>0||/touch|android|iphone|ipod|ipad/i.test(navigator.userAgent))),v.AppRunsOnLegacyTouchDevice}function $e(i,e){return typeof i.item=="function"?i.item(e):i[e]}function Be(i,e){for(var t=0,n=i.length;t<n;t++)if(e.test($e(i,t)))return!0;return!1}function Se(){if(!v.MediaQueriesHaveBeenRewritten&&pe())if(re()){for(var i=document.styleSheets,e=0,t=i.length;e<t;e++)for(var n=i[e].cssRules||i[e].rules,r=0,c=n.length;r<c;r++){var l=n[r];if(l.type===CSSRule.MEDIA_RULE&&Be(l.media,/handheld/i)){var d=l.media;d.mediaText=d.mediaText.replace("handheld","screen")}}for(var p=document.getElementsByTagName("link"),e=0,t=p.length;e<t;e++){var s=p[e];/handheld/i.test(s.media)&&(s.media=s.media.replace("handheld","screen"))}v.MediaQueriesHaveBeenRewritten=!0}else window.addEventListener("DOMContentLoaded",Se)}function ne(){return v.DevicePointingAccuracy==null&&(B(),!re()&&!v.waitingForLoaded&&(v.waitingForLoaded=!0,window.addEventListener("DOMContentLoaded",B))),v.DevicePointingAccuracy}function B(){v.DeviceCanHover=Z("(hover:hover)");var i="fine";switch(!0){case Z("(pointer:none)"):i="none";break;case Z("(pointer:coarse)"):case Z("-moz-touch-enabled"):case pe():i="coarse";break}if(v.DevicePointingAccuracy=i,re()){var e=document.body.classList;if(i==="none"!==e.contains("noPointer")||i==="fine"!==e.contains("finePointer")||i==="coarse"!==e.contains("coarsePointer"))switch(document.body.classList.remove("noPointer","finePointer","coarsePointer"),i){case"none":document.body.classList.add("noPointer");break;case"fine":document.body.classList.add("finePointer");break;case"coarse":document.body.classList.add("coarsePointer");break}}}function Re(i,e){if(typeof i!="function")throw new Error("handler function expected");v.EventHandlerRegistry==null&&(v.EventHandlerRegistry=[]);for(var t=v.EventHandlerRegistry,n=0,r=t.length;n<r;n++)if(t[n].Handler===i){t[n].onceOnly=e;return}t.push({Handler:i,onceOnly:e}),t.length===1&&Je()}function _e(i){v.EventHandlerRegistry==null&&(v.EventHandlerRegistry=[]);for(var e=v.EventHandlerRegistry,t=0,n=e.length;t<n;t++)if(e[t].Handler===i){e.splice(t,1);break}e.length===0&&et()}function Ge(i){Re(i,!1)}function qe(i){Re(i,!0)}function Qe(i){_e(i)}function Je(){v.AccuracyPoller=setInterval(function(){var i=ne();B(),ne()!==i&&tt()},500)}function et(){clearInterval(v.AccuracyPoller),v.AccuracyPoller=void 0}function tt(){v.EventHandlerRegistry==null&&(v.EventHandlerRegistry=[]);for(var i=v.EventHandlerRegistry,e=0,t=i.length;e<t;e++){var n=i[e],r=n.Handler,c=n.onceOnly;try{r(ne())}catch(l){console.warn("PointingAccuracy observation function failed with",l)}c&&_e(r)}}var nt={get isMobile(){return me()},get isPhone(){return ve()},get isTablet(){return me()&&!ve()},get isLegacyTouchDevice(){return pe()},rewriteMediaQueriesOnLegacyTouchDevices:Se,get PointingAccuracy(){return ne()},get canHover(){return Fe()},onPointingAccuracyChanged:Ge,oncePointingAccuracyChanged:qe,offPointingAccuracyChanged:Qe,get observesPointingAccuracy(){return v.AccuracyPoller!=null}};const q={NONE:0,FOREST:1,MOUNTAIN:2,PLAIN:3,WATER:4},m={...q,sample:()=>{const i=Object.keys(q).filter(t=>t!==q.NONE),e=i[Math.floor(Math.random()*i.length)];return q[e]}},we={[m.NONE]:{character:" ",background:"black",foreground:"white"},[m.WATER]:{character:" ",background:"black",foreground:"white"},[m.FOREST]:{character:"t",background:"black",foreground:"white"},[m.MOUNTAIN]:{character:"M",background:"black",foreground:"white"},[m.PLAIN]:{character:"_",background:"black",foreground:"white"}},rt={BLACK_WHITE:we,DEFAULT:we},S={THEME:rt,TILE_TYPES:m},xe=["Earth","Solace","Terra","Nova","Solida","Humus","Viridis","Orb","Solo","Lutum","Vita"],ye=["","Red","Green","Blue","Speckled","Spotted"],Me=["","","","One","Two","Seven"];class it{generate(){const e=xe[Math.floor(Math.random()*xe.length)],t=ye[Math.floor(Math.random()*ye.length)],n=Me[Math.floor(Math.random()*Me.length)];return`${t} ${e} ${n}`.trim()}}var ke={exports:{}};(function(i){(function(e){function t(s){function a(o,h,u){this.x=o,this.y=h,this.z=u}a.prototype.dot2=function(o,h){return this.x*o+this.y*h},a.prototype.dot3=function(o,h,u){return this.x*o+this.y*h+this.z*u},this.grad3=[new a(1,1,0),new a(-1,1,0),new a(1,-1,0),new a(-1,-1,0),new a(1,0,1),new a(-1,0,1),new a(1,0,-1),new a(-1,0,-1),new a(0,1,1),new a(0,-1,1),new a(0,1,-1),new a(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(s||0)}t.prototype.seed=function(s){s>0&&s<1&&(s*=65536),s=Math.floor(s),s<256&&(s|=s<<8);for(var a=this.p,o=0;o<256;o++){var h;o&1?h=a[o]^s&255:h=a[o]^s>>8&255;var u=this.perm,g=this.gradP;u[o]=u[o+256]=h,g[o]=g[o+256]=this.grad3[h%12]}};var n=.5*(Math.sqrt(3)-1),r=(3-Math.sqrt(3))/6,c=1/3,l=1/6;t.prototype.simplex2=function(s,a){var o,h,u,g=(s+a)*n,f=Math.floor(s+g),w=Math.floor(a+g),A=(f+w)*r,y=s-f+A,x=a-w+A,R,b;y>x?(R=1,b=0):(R=0,b=1);var E=y-R+r,T=x-b+r,N=y-1+2*r,M=x-1+2*r;f&=255,w&=255;var L=this.perm,P=this.gradP,_=P[f+L[w]],k=P[f+R+L[w+b]],C=P[f+1+L[w+1]],D=.5-y*y-x*x;D<0?o=0:(D*=D,o=D*D*_.dot2(y,x));var I=.5-E*E-T*T;I<0?h=0:(I*=I,h=I*I*k.dot2(E,T));var O=.5-N*N-M*M;return O<0?u=0:(O*=O,u=O*O*C.dot2(N,M)),70*(o+h+u)},t.prototype.simplex3=function(s,a,o){var h,u,g,f,w=(s+a+o)*c,A=Math.floor(s+w),y=Math.floor(a+w),x=Math.floor(o+w),R=(A+y+x)*l,b=s-A+R,E=a-y+R,T=o-x+R,N,M,L,P,_,k;b>=E?E>=T?(N=1,M=0,L=0,P=1,_=1,k=0):b>=T?(N=1,M=0,L=0,P=1,_=0,k=1):(N=0,M=0,L=1,P=1,_=0,k=1):E<T?(N=0,M=0,L=1,P=0,_=1,k=1):b<T?(N=0,M=1,L=0,P=0,_=1,k=1):(N=0,M=1,L=0,P=1,_=1,k=0);var C=b-N+l,D=E-M+l,I=T-L+l,O=b-P+2*l,ie=E-_+2*l,oe=T-k+2*l,se=b-1+3*l,ae=E-1+3*l,le=T-1+3*l;A&=255,y&=255,x&=255;var W=this.perm,G=this.gradP,De=G[A+W[y+W[x]]],Ie=G[A+N+W[y+M+W[x+L]]],Oe=G[A+P+W[y+_+W[x+k]]],ze=G[A+1+W[y+1+W[x+1]]],H=.5-b*b-E*E-T*T;H<0?h=0:(H*=H,h=H*H*De.dot3(b,E,T));var V=.5-C*C-D*D-I*I;V<0?u=0:(V*=V,u=V*V*Ie.dot3(C,D,I));var K=.5-O*O-ie*ie-oe*oe;K<0?g=0:(K*=K,g=K*K*Oe.dot3(O,ie,oe));var j=.5-se*se-ae*ae-le*le;return j<0?f=0:(j*=j,f=j*j*ze.dot3(se,ae,le)),32*(h+u+g+f)};function d(s){return s*s*s*(s*(s*6-15)+10)}function p(s,a,o){return(1-o)*s+o*a}t.prototype.perlin2=function(s,a){var o=Math.floor(s),h=Math.floor(a);s=s-o,a=a-h,o=o&255,h=h&255;var u=this.perm,g=this.gradP,f=g[o+u[h]].dot2(s,a),w=g[o+u[h+1]].dot2(s,a-1),A=g[o+1+u[h]].dot2(s-1,a),y=g[o+1+u[h+1]].dot2(s-1,a-1),x=d(s);return p(p(f,A,x),p(w,y,x),d(a))},t.prototype.perlin3=function(s,a,o){var h=Math.floor(s),u=Math.floor(a),g=Math.floor(o);s=s-h,a=a-u,o=o-g,h=h&255,u=u&255,g=g&255;var f=this.perm,w=this.gradP,A=w[h+f[u+f[g]]].dot3(s,a,o),y=w[h+f[u+f[g+1]]].dot3(s,a,o-1),x=w[h+f[u+1+f[g]]].dot3(s,a-1,o),R=w[h+f[u+1+f[g+1]]].dot3(s,a-1,o-1),b=w[h+1+f[u+f[g]]].dot3(s-1,a,o),E=w[h+1+f[u+f[g+1]]].dot3(s-1,a,o-1),T=w[h+1+f[u+1+f[g]]].dot3(s-1,a-1,o),N=w[h+1+f[u+1+f[g+1]]].dot3(s-1,a-1,o-1),M=d(s),L=d(a),P=d(o);return p(p(p(A,b,M),p(y,E,M),P),p(p(x,T,M),p(R,N,M),P),L)},e.Noise=t})(i.exports)})(ke);var ot=ke.exports;class be{twoLandsMatrix(){return[[m.WATER,m.WATER,m.PLAIN,m.FOREST],[m.PLAIN,m.PLAIN,m.WATER,m.PLAIN],[m.FOREST,m.PLAIN,m.WATER,m.WATER],[m.MOUNTAIN,m.FOREST,m.PLAIN,m.WATER]]}waterWorldMatrix(){return[[m.WATER,m.WATER,m.WATER,m.WATER],[m.WATER,m.WATER,m.WATER,m.WATER],[m.WATER,m.WATER,m.WATER,m.WATER],[m.MOUNTAIN,m.WATER,m.WATER,m.WATER]]}noiseMatrix(e,t,n={x:0,y:0,z:0}){const r=new ot.Noise(e),c=[],l=n.x,d=n.y,p=n.z||1;for(let s=0;s<t;s++){const a=[];for(let o=0;o<t;o++){const h=r.simplex2((l+s)*(this.step()/p),(d+o)*this.step()/p),u=this.contrast(h);a.push(this.bar(u))}c.push(a)}return c}step(){return .2}contrast(e){return(e+1)/2}bars(){return[m.WATER,m.WATER,m.PLAIN,m.FOREST,m.MOUNTAIN]}bar(e){const t=this.bars();return t[Math.floor(t.length*e)]}}function de(i,e,t){return Math.min(Math.max(i,e),t)}function Te(i){return i%2===0}function st(i){return i[Math.floor(Math.random()*i.length)]}class X{constructor(e,t,n){this.x=e,this.y=t,this.z=n}toString(){return`${this.x},${this.y},${this.z}`}}class at{constructor({theme:e=S.THEME.BLACK_WHITE,maxScroll:t=64,maxZoom:n=4}){this.theme=e,this._maxXyScroll=t,this._maxZ=n,this.seed=Math.random(),this.regenerate()}regenerate(){this.seed=Math.random(),this.name=this.initializeName(),this.currentPosition=new X(0,0,0),this.matrixMap={[this.currentPosition.toString()]:this.initializeMatrix()}}get matrix(){return this.matrixMap[this.currentPosition.toString()]}getMatrix(){return this.matrixMap[this.currentPosition.toString()]}themedMatrix(e){return this.matrix.map(t=>t.map(n=>e[n].character))}coloredMatrix(){return this.themedMatrix(this.theme)}initializeMatrix(){return new be().noiseMatrix(this.seed,4)}initializeName(){return new it().generate()}setName(e){this.name=e}cycleTheme(){const e=S.THEME.constants.map(r=>S.THEME[r]),n=(e.indexOf(this.theme)+1)%e.length;this.setTheme(e[n])}setTheme(e){this.theme=e}draw(e){return this.renderMapWithInfo(e)}renderMapWithInfo(e){return[this.worldNameDisplay(),this.zoomLevelDisplay(),this.coordinatesDisplay(),"",this.renderMap(e)].join(`\r
`)}renderMap(e){return this.renderMatrix(this.coloredMatrix(),this.theme,e)}renderMatrix(e,t,n){return e.map((r,c)=>r.map((l,d)=>l).join(t[S.TILE_TYPES.NONE].character.repeat(n))).join(`\r
`.repeat(n))}worldNameDisplay(){return`You are exploring _${this.name}_`}zoomLevelDisplay(){return`Zoom: ${this.currentPosition.z}`}coordinatesDisplay(){return`x: ${this.currentPosition.x}, y: ${this.currentPosition.y}`}currentMatrixWidth(){return this.matrix.length}nextMatrixWidth(){return this.currentMatrixWidth()*2-1}matrixExistsInPosition(e){return this.matrixMap.hasOwnProperty(e.toString())}zoomIn(){const e=this.incrementZLevel(this.currentPosition);this.matrixExistsInPosition(e)||this.generateNewZoomedInMap(e),this.currentPosition=e}zoomOut(){const e=this.decrementZLevel(this.currentPosition);this.matrixExistsInPosition(e)||this.generateNewZoomedOutMap(e),this.currentPosition=e}selectMatricesAtXAndZ(e,t){const n={};for(const r in e)this.matrixKeyMatchesXAndZ(r,t.x,t.z)&&(n[r]=e[r]);return n}selectMatricesAtYAndZ(e,t){const n={};for(const r in e)this.matrixKeyMatchesYAndZ(r,t.y,t.z)&&(n[r]=e[r]);return n}matrixKeyMatchesXAndZ(e,t,n){const[r,c,l]=e.split(",").map(Number);return t===r&&n===l}matrixKeyMatchesYAndZ(e,t,n){const[r,c,l]=e.split(",").map(Number);return t===c&&n===l}transformMatrixKeyToPoint(e){const[t,n,r]=e.split(",").map(Number);return new X(t,n,r)}fillMatrixMapWith(e){for(const t of e)this.matrixMap[t.key]=t.value}setCurrentPosition(e){this.currentPosition=e}scrollRight(){this.scrollRightV3()}scrollLeft(){this.scrollLeftV3()}scrollUp(){this.scrollUpV3()}scrollDown(){this.scrollDownV3()}scrollV3(e){const t=e(this.currentPosition);if(!this.matrixExistsInPosition(t)){const n=this.currentMatrixWidth(),r=new be().noiseMatrix(this.seed,n,{x:-t.y,y:t.x,z:t.z});this.matrixMap[t.toString()]=r}this.setCurrentPosition(t)}scrollRightV3(){this.scrollV3(this.incrementXLevel.bind(this))}scrollLeftV3(){this.scrollV3(this.decrementXLevel.bind(this))}scrollUpV3(){this.scrollV3(this.incrementYLevel.bind(this))}scrollDownV3(){this.scrollV3(this.decrementYLevel.bind(this))}scrollV2(e,t,n){const r=e(this.currentPosition),d=Object.entries(t(this.matrixMap,this.currentPosition)).map(([p,s])=>{const a=this.transformMatrixKeyToPoint(p),o=e(a);return{key:this.matrixMap[o.toString()]?null:o.toString(),value:n(s)}}).filter(p=>p.key!==null);this.fillMatrixMapWith(d),this.setCurrentPosition(r)}scrollRightV2(){this.scrollV2(this.incrementXLevel.bind(this),this.selectMatricesAtXAndZ.bind(this),this.getMatrixScrolledRight.bind(this))}scrollLeftV2(){this.scrollV2(this.decrementXLevel.bind(this),this.selectMatricesAtXAndZ.bind(this),this.getMatrixScrolledLeft.bind(this))}scrollUpV2(){this.scrollV2(this.incrementYLevel.bind(this),this.selectMatricesAtYAndZ.bind(this),this.getMatrixScrolledUp.bind(this))}scrollDownV2(){this.scrollV2(this.decrementYLevel.bind(this),this.selectMatricesAtYAndZ.bind(this),this.getMatrixScrolledDown.bind(this))}incrementXLevel(e){return this.addToXLevel(1,e)}decrementXLevel(e){return this.addToXLevel(-1,e)}incrementYLevel(e){return this.addToYLevel(1,e)}decrementYLevel(e){return this.addToYLevel(-1,e)}incrementZLevel(e){return this.addToZLevel(1,e)}decrementZLevel(e){return this.addToZLevel(-1,e)}addToXLevel(e,t){const n=de(t.x+e,-this.maxX(),this.maxX());return new X(n,t.y,t.z)}addToYLevel(e,t){const n=de(t.y+e,-this.maxY(),this.maxY());return new X(t.x,n,t.z)}addToZLevel(e,t){const n=de(t.z+e,0,this.maxZ()),r=this.isZoomingOut(e);return new X(r?0:t.x,r?0:t.y,n)}isZoomingOut(e){return e<0}maxX(){return this.scrollable()?this.maxXYScroll():0}maxY(){return this.scrollable()?this.maxXYScroll():0}scrollable(){return!1}maxXYScroll(){return this._maxXyScroll}maxZ(){return this._maxZ}generateNewZoomedInMap(e){const t=this.nextMatrixWidth(),n=[];this.matrix.forEach((c,l)=>{n.push(this.expandedRow(t,this.matrix[l])),n.length<t&&n.push(this.newRow(t))});const r=this.fillNoneTiles(n);this.matrixMap[e.toString()]=r}generateNewZoomedOutMap(e){const t=[];this.matrix.forEach((n,r)=>{if(Te(r)){const c=[];this.matrix[r].forEach((l,d)=>{Te(d)&&c.push(l)}),t.push(c)}}),this.matrixMap[e.toString()]=t}getMatrixScrolledRight(e){const t=this.expandMatrixRight(e);return this.fillNoneTiles(t)}getMatrixScrolledLeft(e){const t=this.expandMatrixLeft(e);return this.fillNoneTiles(t)}getMatrixScrolledUp(e){const t=this.expandMatrixUp(e);return this.fillNoneTiles(t)}getMatrixScrolledDown(e){const t=this.expandMatrixDown(e);return this.fillNoneTiles(t)}expandMatrixRight(e){return e.map((t,n)=>{const r=t.slice();return r.shift(),r.push(S.TILE_TYPES.NONE),r})}expandMatrixLeft(e){return e.map((t,n)=>{const r=t.slice();return r.pop(),r.unshift(S.TILE_TYPES.NONE),r})}expandMatrixUp(e){const t=[];return e.forEach((n,r)=>{r<this.currentMatrixWidth()-1&&t.push(n.slice())}),t.unshift(this.newRow(this.currentMatrixWidth())),t}expandMatrixDown(e){const t=[];return e.forEach((n,r)=>{r>0&&t.push(n.slice())}),t.push(this.newRow(this.currentMatrixWidth())),t}expandedRow(e,t){const n=[];return t.forEach((r,c)=>{n.push(t[c]),n.length<e&&n.push(S.TILE_TYPES.NONE)}),n}newRow(e){return Array(e).fill(S.TILE_TYPES.NONE)}fillNoneTiles(e){const t=[];return e.forEach((n,r)=>{const c=[];n.forEach((l,d)=>{let p=l;if(l===S.TILE_TYPES.NONE){const a=this.getTilesInNeighboringPositions(d,r,e).filter(h=>![S.TILE_TYPES.NONE].includes(h)),o=st(a);o!==S.TILE_TYPES.NONE?p=o:p=S.TILE_TYPES.sample()}c.push(p)}),t.push(c)}),t}getTilesInNeighboringPositions(e,t,n){const r=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1},{x:-1,y:-1},{x:1,y:1},{x:1,y:-1},{x:-1,y:1}],c=[];return r.forEach(l=>{const d=this.getTileAtPosition(e+l.x,t+l.y,n);d&&c.push(d)}),c}getTileAtPosition(e,t,n){try{return n[t][e]}catch{return!1}}}class lt{constructor({tileSize:e=1,theme:t=S.THEME.DEFAULT,maxZoom:n=10,maxScroll:r=64}){this._tileSize=e,this.theme=t,this.maxZoom=n,this.maxScroll=r,this._world=this.initializeWorld()}get world(){return this._world}set world(e){this._world=e}get tileSize(){return this._tileSize}set tileSize(e){this._tileSize=e}draw(){return this.world.draw(this.tileSize)}initializeWorld(){return new at({theme:S.THEME[this.theme],maxZoom:this.maxZoom,maxScroll:this.maxScroll})}}class ct{constructor(e){this.running=!1,this.display=e,this.promptOutput=null}get world(){return this.display.world}run(){return[this.showKeyPrompts(),this.display.draw(),"","-----------------------","",""].join(`\r
`)}onKeypress(e){this.handleDefaultKeypress(e)}handleDefaultKeypress(e){const t=e.key,n=e.code;this.getKeyMap()[t]&&this.getKeyMap()[t](),this.getKeyMap()[n]&&this.getKeyMap()[n]()}prompt(e){return window.prompt(e)}getKeyMap(){const e=this.world;return{r:e.regenerate.bind(e),z:e.zoomIn.bind(e),x:e.zoomOut.bind(e),n:this.nameWorld.bind(this),e:()=>this.exportToTxt(this.world,this.display),p:()=>this.exportToPNG(this.world,this.display),ArrowUp:e.scrollUp.bind(e),ArrowDown:e.scrollDown.bind(e),ArrowRight:e.scrollRight.bind(e),ArrowLeft:e.scrollLeft.bind(e)}}getKeymapLabel(e){return{r:"to generate new world",z:"to zoom in",x:"to zoom out",n:"to rename this world",c:"to switch theme",e:"to save this world in text",p:"to save this world as image"}[e]}showKeyPrompts(){return["","r to generate new world",this.world.scrollable()?"arrow keys to explore":"","z to zoom in","x to zoom out","n to rename this world","e to save this world in text","p to save this world as image","-----------------------",""].join(`\r
`)}nameWorld(){const e=this.prompt("what do people call this world?");this.world.setName(e)}defaultAction(){return!0}createFileName(e,t="txt"){const n=new Date;return`${n.getFullYear()}_${(n.getMonth()+1).toString().padStart(2,"0")}_${n.getDate().toString().padStart(2,"0")}__${n.getHours().toString().padStart(2,"0")}${n.getMinutes().toString().padStart(2,"0")}${n.getSeconds().toString().padStart(2,"0")}_${e.name.replace(/\s+/g,"_")}.${t}`}exportToTxt(e,t){const n=e.draw(t.tileSize),r=this.createFileName(e),c=new Blob([n],{type:"text/plain"}),l=URL.createObjectURL(c),d=document.createElement("a");d.href=l,d.download=r,d.textContent="Download File",document.body.appendChild(d),d.click(),document.body.removeChild(d),window.alert(`Successfully saved to ${r}`)}exportToPNG(e,t){const r=e.draw(t.tileSize).split(/\r?\n/),c=document.createElement("canvas"),l=11,d=l,p=20,s=e.worldNameDisplay().length*l,a=Math.max(s,r.at(-1).length*l*.6)+p*2,o=r.length*d+p*2;c.width=a,c.height=o;const h=c.getContext("2d");this.renderToCanvas(h,r,c.width,c.height,l,d,p);const u=c.toDataURL("image/png"),g=this.createFileName(e,"png"),f=document.createElement("a");f.href=u,f.download=g,f.textContent="Download Image",document.body.appendChild(f),f.click(),document.body.removeChild(f),window.alert(`Successfully saved to ${g}`)}renderToCanvas(e,t,n,r,c=11,l=20,d=0){e.font=`${c}px monospace`,e.textBaseline="top";const p=document.documentElement,s=getComputedStyle(p).getPropertyValue("--color-bg");e.fillStyle=s,e.fillRect(0,0,n,r);const a=getComputedStyle(p).getPropertyValue("--color-output");e.fillStyle=a,t.forEach((o,h)=>{e.fillText(o,d,d+h*l)})}}class ht{explore({tileSize:e=1,theme:t="DEFAULT",maxZoom:n=10,maxScroll:r=64}){const c=new lt({tileSize:e,theme:t,maxZoom:n,maxScroll:r});return{engine:new ct(c),display:c}}}const{document:Ee}=Ue;function Pe(i,e,t){const n=i.slice();return n[10]=e[t][0],n[11]=e[t][1],n}function Ae(i){let e,t=ge(Object.entries(i[1])),n=[];for(let r=0;r<t.length;r+=1)n[r]=Ne(Pe(i,t,r));return{c(){e=U("div");for(let r=0;r<n.length;r+=1)n[r].c();this.h()},l(r){e=F(r,"DIV",{class:!0});var c=ee(e);for(let l=0;l<n.length;l+=1)n[l].l(c);c.forEach(z),this.h()},h(){$(e,"class","output output-mobile svelte-1htdobs")},m(r,c){te(r,e,c);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(e,null)},p(r,c){if(c&2){t=ge(Object.entries(r[1]));let l;for(l=0;l<t.length;l+=1){const d=Pe(r,t,l);n[l]?n[l].p(d,c):(n[l]=Ne(d),n[l].c(),n[l].m(e,null))}for(;l<n.length;l+=1)n[l].d(1);n.length=t.length}},d(r){r&&z(e),Xe(n,r)}}}function Ne(i){let e,t=i[10]+"",n,r,c=i[11].label+"",l,d,p;return{c(){e=U("button"),n=Q(t),r=Q(": "),l=Q(c),this.h()},l(s){e=F(s,"BUTTON",{class:!0});var a=ee(e);n=J(a,t),r=J(a,": "),l=J(a,c),a.forEach(z),this.h()},h(){$(e,"class"," svelte-1htdobs")},m(s,a){te(s,e,a),Y(e,n),Y(e,r),Y(e,l),d||(p=Le(e,"click",function(){Ze(i[11].handle)&&i[11].handle.apply(this,arguments)}),d=!0)},p(s,a){i=s,a&2&&t!==(t=i[10]+"")&&ue(n,t),a&2&&c!==(c=i[11].label+"")&&ue(l,c)},d(s){s&&z(e),d=!1,p()}}}function dt(i){let e,t,n,r,c,l,d,p="This is a javascript port of my earlier Ruby World Generator, which was packaged as a ruby gem. This implementation is a web app for the browser, and uses the same world generation algorithms as the original.",s,a,o=i[0]&&Ae(i);return{c(){e=ce(),t=U("div"),o&&o.c(),n=ce(),r=U("div"),c=Q(i[2]),l=ce(),d=U("div"),d.textContent=p,this.h()},l(h){Ve("svelte-1icwu7a",Ee.head).forEach(z),e=he(h),t=F(h,"DIV",{class:!0});var g=ee(t);o&&o.l(g),n=he(g),r=F(g,"DIV",{class:!0});var f=ee(r);c=J(f,i[2]),f.forEach(z),l=he(g),d=F(g,"DIV",{class:!0,style:!0,"data-svelte-h":!0}),Ke(d)!=="svelte-1eb5mkr"&&(d.textContent=p),g.forEach(z),this.h()},h(){Ee.title="World in Your Terminal",$(r,"class","output map svelte-1htdobs"),$(d,"class","output"),je(d,"margin-bottom","1rem"),$(t,"class","terminal")},m(h,u){te(h,e,u),te(h,t,u),o&&o.m(t,null),Y(t,n),Y(t,r),Y(r,c),Y(t,l),Y(t,d),s||(a=Le(window,"keydown",i[3]),s=!0)},p(h,[u]){h[0]?o?o.p(h,u):(o=Ae(h),o.c(),o.m(t,n)):o&&(o.d(1),o=null),u&4&&ue(c,h[2])},i:fe,o:fe,d(h){h&&(z(e),z(t)),o&&o.d(),s=!1,a()}}}function ut(i,e){return i.split(`
`).slice(e).join(`
`)}function mt(i,e,t){let n,r="",c,l={},d;Ye(()=>{const{engine:a}=new ht().explore({tileSize:1,maxZoom:8});c=a,t(4,r=a.run()),t(1,l=p(c.getKeyMap())),t(0,d=nt.isMobile)});function p(a){const o={};return Object.entries(a).forEach(([h])=>{const u=c.getKeymapLabel(h);u&&(o[h]={label:u,handle:()=>s({key:h})})}),o}function s(a){c.onKeypress(a),t(4,r=c.run())}return i.$$.update=()=>{i.$$.dirty&17&&t(2,n=ut(r,d?8:1))},[d,l,n,s,r]}class gt extends Ce{constructor(e){super(),He(this,e,mt,dt,We,{})}}export{gt as component};
