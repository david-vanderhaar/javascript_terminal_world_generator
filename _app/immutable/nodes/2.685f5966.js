import{s as wt,n as et,o as vt}from"../chunks/scheduler.e108d1fd.js";import{S as Mt,i as Tt,s as rt,g as q,m as yt,y as Et,f as X,c as it,h as J,j as nt,z as Nt,n as bt,k as Q,l as St,a as st,x as $,A as At,o as _t}from"../chunks/index.f2815fed.js";const Lt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,K={NONE:0,FOREST:1,MOUNTAIN:2,PLAIN:3,WATER:4},h={...K,sample:()=>{const x=Object.keys(K).filter(e=>e!==K.NONE),t=x[Math.floor(Math.random()*x.length)];return K[t]}},ot={[h.NONE]:{character:" ",background:"black",foreground:"white"},[h.WATER]:{character:" ",background:"black",foreground:"white"},[h.FOREST]:{character:"t",background:"black",foreground:"white"},[h.MOUNTAIN]:{character:"M",background:"black",foreground:"white"},[h.PLAIN]:{character:"_",background:"black",foreground:"white"}},Pt={BLACK_WHITE:ot,DEFAULT:ot},_={THEME:Pt,TILE_TYPES:h},at=["Earth","Solace","Terra","Nova","Solida","Humus","Viridis","Orb","Solo","Lutum","Vita"],lt=["","Red","Green","Blue","Speckled","Spotted"],ht=["","","","One","Two","Seven"];class Rt{generate(){const t=at[Math.floor(Math.random()*at.length)],e=lt[Math.floor(Math.random()*lt.length)],r=ht[Math.floor(Math.random()*ht.length)];return`${e} ${t} ${r}`.trim()}}var mt={exports:{}};(function(x){(function(t){function e(o){function n(s,a,d){this.x=s,this.y=a,this.z=d}n.prototype.dot2=function(s,a){return this.x*s+this.y*a},n.prototype.dot3=function(s,a,d){return this.x*s+this.y*a+this.z*d},this.grad3=[new n(1,1,0),new n(-1,1,0),new n(1,-1,0),new n(-1,-1,0),new n(1,0,1),new n(-1,0,1),new n(1,0,-1),new n(-1,0,-1),new n(0,1,1),new n(0,-1,1),new n(0,1,-1),new n(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(o||0)}e.prototype.seed=function(o){o>0&&o<1&&(o*=65536),o=Math.floor(o),o<256&&(o|=o<<8);for(var n=this.p,s=0;s<256;s++){var a;s&1?a=n[s]^o&255:a=n[s]^o>>8&255;var d=this.perm,f=this.gradP;d[s]=d[s+256]=a,f[s]=f[s+256]=this.grad3[a%12]}};var r=.5*(Math.sqrt(3)-1),i=(3-Math.sqrt(3))/6,c=1/3,l=1/6;e.prototype.simplex2=function(o,n){var s,a,d,f=(o+n)*r,u=Math.floor(o+f),g=Math.floor(n+f),b=(u+g)*i,v=o-u+b,w=n-g+b,L,T;v>w?(L=1,T=0):(L=0,T=1);var E=v-L+i,y=w-T+i,S=v-1+2*i,M=w-1+2*i;u&=255,g&=255;var A=this.perm,N=this.gradP,P=N[u+A[g]],R=N[u+L+A[g+T]],z=N[u+1+A[g+1]],W=.5-v*v-w*w;W<0?s=0:(W*=W,s=W*W*P.dot2(v,w));var I=.5-E*E-y*y;I<0?a=0:(I*=I,a=I*I*R.dot2(E,y));var k=.5-S*S-M*M;return k<0?d=0:(k*=k,d=k*k*z.dot2(S,M)),70*(s+a+d)},e.prototype.simplex3=function(o,n,s){var a,d,f,u,g=(o+n+s)*c,b=Math.floor(o+g),v=Math.floor(n+g),w=Math.floor(s+g),L=(b+v+w)*l,T=o-b+L,E=n-v+L,y=s-w+L,S,M,A,N,P,R;T>=E?E>=y?(S=1,M=0,A=0,N=1,P=1,R=0):T>=y?(S=1,M=0,A=0,N=1,P=0,R=1):(S=0,M=0,A=1,N=1,P=0,R=1):E<y?(S=0,M=0,A=1,N=0,P=1,R=1):T<y?(S=0,M=1,A=0,N=0,P=1,R=1):(S=0,M=1,A=0,N=1,P=1,R=0);var z=T-S+l,W=E-M+l,I=y-A+l,k=T-N+2*l,j=E-P+2*l,F=y-R+2*l,H=T-1+3*l,G=E-1+3*l,B=y-1+3*l;b&=255,v&=255,w&=255;var Y=this.perm,U=this.gradP,pt=U[b+Y[v+Y[w]]],ft=U[b+S+Y[v+M+Y[w+A]]],xt=U[b+N+Y[v+P+Y[w+R]]],gt=U[b+1+Y[v+1+Y[w+1]]],O=.5-T*T-E*E-y*y;O<0?a=0:(O*=O,a=O*O*pt.dot3(T,E,y));var Z=.5-z*z-W*W-I*I;Z<0?d=0:(Z*=Z,d=Z*Z*ft.dot3(z,W,I));var D=.5-k*k-j*j-F*F;D<0?f=0:(D*=D,f=D*D*xt.dot3(k,j,F));var V=.5-H*H-G*G-B*B;return V<0?u=0:(V*=V,u=V*V*gt.dot3(H,G,B)),32*(a+d+f+u)};function m(o){return o*o*o*(o*(o*6-15)+10)}function p(o,n,s){return(1-s)*o+s*n}e.prototype.perlin2=function(o,n){var s=Math.floor(o),a=Math.floor(n);o=o-s,n=n-a,s=s&255,a=a&255;var d=this.perm,f=this.gradP,u=f[s+d[a]].dot2(o,n),g=f[s+d[a+1]].dot2(o,n-1),b=f[s+1+d[a]].dot2(o-1,n),v=f[s+1+d[a+1]].dot2(o-1,n-1),w=m(o);return p(p(u,b,w),p(g,v,w),m(n))},e.prototype.perlin3=function(o,n,s){var a=Math.floor(o),d=Math.floor(n),f=Math.floor(s);o=o-a,n=n-d,s=s-f,a=a&255,d=d&255,f=f&255;var u=this.perm,g=this.gradP,b=g[a+u[d+u[f]]].dot3(o,n,s),v=g[a+u[d+u[f+1]]].dot3(o,n,s-1),w=g[a+u[d+1+u[f]]].dot3(o,n-1,s),L=g[a+u[d+1+u[f+1]]].dot3(o,n-1,s-1),T=g[a+1+u[d+u[f]]].dot3(o-1,n,s),E=g[a+1+u[d+u[f+1]]].dot3(o-1,n,s-1),y=g[a+1+u[d+1+u[f]]].dot3(o-1,n-1,s),S=g[a+1+u[d+1+u[f+1]]].dot3(o-1,n-1,s-1),M=m(o),A=m(n),N=m(s);return p(p(p(b,T,M),p(v,E,M),N),p(p(w,y,M),p(L,S,M),N),A)},t.Noise=e})(x.exports)})(mt);var Wt=mt.exports;class ct{twoLandsMatrix(){return[[h.WATER,h.WATER,h.PLAIN,h.FOREST],[h.PLAIN,h.PLAIN,h.WATER,h.PLAIN],[h.FOREST,h.PLAIN,h.WATER,h.WATER],[h.MOUNTAIN,h.FOREST,h.PLAIN,h.WATER]]}waterWorldMatrix(){return[[h.WATER,h.WATER,h.WATER,h.WATER],[h.WATER,h.WATER,h.WATER,h.WATER],[h.WATER,h.WATER,h.WATER,h.WATER],[h.MOUNTAIN,h.WATER,h.WATER,h.WATER]]}noiseMatrix(t,e,r={x:0,y:0,z:0}){const i=new Wt.Noise(t),c=[],l=r.x,m=r.y,p=r.z||1;for(let o=0;o<e;o++){const n=[];for(let s=0;s<e;s++){const a=i.simplex2((l+o)*(this.step()/p),(m+s)*this.step()/p),d=this.contrast(a);n.push(this.bar(d))}c.push(n)}return c}step(){return .2}contrast(t){return(t+1)/2}bars(){return[h.WATER,h.WATER,h.PLAIN,h.FOREST,h.MOUNTAIN]}bar(t){const e=this.bars();return e[Math.floor(e.length*t)]}}function tt(x,t,e){return Math.min(Math.max(x,t),e)}function dt(x){return x%2===0}function It(x){return x[Math.floor(Math.random()*x.length)]}class C{constructor(t,e,r){this.x=t,this.y=e,this.z=r}toString(){return`${this.x},${this.y},${this.z}`}}class kt{constructor({theme:t=_.THEME.BLACK_WHITE,maxScroll:e=64,maxZoom:r=4}){this.theme=t,this._maxXyScroll=e,this._maxZ=r,this.seed=Math.random(),this.regenerate()}regenerate(){this.seed=Math.random(),this.name=this.initializeName(),this.currentPosition=new C(0,0,0),this.matrixMap={[this.currentPosition.toString()]:this.initializeMatrix()}}get matrix(){return this.matrixMap[this.currentPosition.toString()]}getMatrix(){return this.matrixMap[this.currentPosition.toString()]}themedMatrix(t){return this.matrix.map(e=>e.map(r=>t[r].character))}coloredMatrix(){return this.themedMatrix(this.theme)}initializeMatrix(){return new ct().noiseMatrix(this.seed,4)}initializeName(){return new Rt().generate()}setName(t){this.name=t}cycleTheme(){const t=_.THEME.constants.map(i=>_.THEME[i]),r=(t.indexOf(this.theme)+1)%t.length;this.setTheme(t[r])}setTheme(t){this.theme=t}draw(t){return this.renderMapWithInfo(t)}renderMapWithInfo(t){return[this.renderMap(t),"",this.worldNameDisplay(),this.zoomLevelDisplay(),this.coordinatesDisplay()].join(`\r
`)}renderMap(t){return this.renderMatrix(this.coloredMatrix(),this.theme,t)}renderMatrix(t,e,r){return t.map((i,c)=>i.map((l,m)=>l).join(e[_.TILE_TYPES.NONE].character.repeat(r))).join(`\r
`.repeat(r))}worldNameDisplay(){return`You are exploring _${this.name}_`}zoomLevelDisplay(){return`Zoom: ${this.currentPosition.z}`}coordinatesDisplay(){return`x: ${this.currentPosition.x}, y: ${this.currentPosition.y}`}currentMatrixWidth(){return this.matrix.length}nextMatrixWidth(){return this.currentMatrixWidth()*2-1}matrixExistsInPosition(t){return this.matrixMap.hasOwnProperty(t.toString())}zoomIn(){const t=this.incrementZLevel(this.currentPosition);this.matrixExistsInPosition(t)||this.generateNewZoomedInMap(t),this.currentPosition=t}zoomOut(){const t=this.decrementZLevel(this.currentPosition);this.matrixExistsInPosition(t)||this.generateNewZoomedOutMap(t),this.currentPosition=t}selectMatricesAtXAndZ(t,e){const r={};for(const i in t)this.matrixKeyMatchesXAndZ(i,e.x,e.z)&&(r[i]=t[i]);return r}selectMatricesAtYAndZ(t,e){const r={};for(const i in t)this.matrixKeyMatchesYAndZ(i,e.y,e.z)&&(r[i]=t[i]);return r}matrixKeyMatchesXAndZ(t,e,r){const[i,c,l]=t.split(",").map(Number);return e===i&&r===l}matrixKeyMatchesYAndZ(t,e,r){const[i,c,l]=t.split(",").map(Number);return e===c&&r===l}transformMatrixKeyToPoint(t){const[e,r,i]=t.split(",").map(Number);return new C(e,r,i)}fillMatrixMapWith(t){for(const e of t)this.matrixMap[e.key]=e.value}setCurrentPosition(t){this.currentPosition=t}scrollRight(){this.scrollRightV3()}scrollLeft(){this.scrollLeftV3()}scrollUp(){this.scrollUpV3()}scrollDown(){this.scrollDownV3()}scrollV3(t){const e=t(this.currentPosition);if(!this.matrixExistsInPosition(e)){const r=this.currentMatrixWidth(),i=new ct().noiseMatrix(this.seed,r,{x:-e.y,y:e.x,z:e.z});this.matrixMap[e.toString()]=i}this.setCurrentPosition(e)}scrollRightV3(){this.scrollV3(this.incrementXLevel.bind(this))}scrollLeftV3(){this.scrollV3(this.decrementXLevel.bind(this))}scrollUpV3(){this.scrollV3(this.incrementYLevel.bind(this))}scrollDownV3(){this.scrollV3(this.decrementYLevel.bind(this))}scrollV2(t,e,r){const i=t(this.currentPosition),m=Object.entries(e(this.matrixMap,this.currentPosition)).map(([p,o])=>{const n=this.transformMatrixKeyToPoint(p),s=t(n);return{key:this.matrixMap[s.toString()]?null:s.toString(),value:r(o)}}).filter(p=>p.key!==null);this.fillMatrixMapWith(m),this.setCurrentPosition(i)}scrollRightV2(){this.scrollV2(this.incrementXLevel.bind(this),this.selectMatricesAtXAndZ.bind(this),this.getMatrixScrolledRight.bind(this))}scrollLeftV2(){this.scrollV2(this.decrementXLevel.bind(this),this.selectMatricesAtXAndZ.bind(this),this.getMatrixScrolledLeft.bind(this))}scrollUpV2(){this.scrollV2(this.incrementYLevel.bind(this),this.selectMatricesAtYAndZ.bind(this),this.getMatrixScrolledUp.bind(this))}scrollDownV2(){this.scrollV2(this.decrementYLevel.bind(this),this.selectMatricesAtYAndZ.bind(this),this.getMatrixScrolledDown.bind(this))}incrementXLevel(t){return this.addToXLevel(1,t)}decrementXLevel(t){return this.addToXLevel(-1,t)}incrementYLevel(t){return this.addToYLevel(1,t)}decrementYLevel(t){return this.addToYLevel(-1,t)}incrementZLevel(t){return this.addToZLevel(1,t)}decrementZLevel(t){return this.addToZLevel(-1,t)}addToXLevel(t,e){const r=tt(e.x+t,-this.maxX(),this.maxX());return new C(r,e.y,e.z)}addToYLevel(t,e){const r=tt(e.y+t,-this.maxY(),this.maxY());return new C(e.x,r,e.z)}addToZLevel(t,e){const r=tt(e.z+t,0,this.maxZ()),i=this.isZoomingOut(t);return new C(i?0:e.x,i?0:e.y,r)}isZoomingOut(t){return t<0}maxX(){return this.scrollable()?this.maxXYScroll():0}maxY(){return this.scrollable()?this.maxXYScroll():0}scrollable(){return!1}maxXYScroll(){return this._maxXyScroll}maxZ(){return this._maxZ}generateNewZoomedInMap(t){const e=this.nextMatrixWidth(),r=[];this.matrix.forEach((c,l)=>{r.push(this.expandedRow(e,this.matrix[l])),r.length<e&&r.push(this.newRow(e))});const i=this.fillNoneTiles(r);this.matrixMap[t.toString()]=i}generateNewZoomedOutMap(t){const e=[];this.matrix.forEach((r,i)=>{if(dt(i)){const c=[];this.matrix[i].forEach((l,m)=>{dt(m)&&c.push(l)}),e.push(c)}}),this.matrixMap[t.toString()]=e}getMatrixScrolledRight(t){const e=this.expandMatrixRight(t);return this.fillNoneTiles(e)}getMatrixScrolledLeft(t){const e=this.expandMatrixLeft(t);return this.fillNoneTiles(e)}getMatrixScrolledUp(t){const e=this.expandMatrixUp(t);return this.fillNoneTiles(e)}getMatrixScrolledDown(t){const e=this.expandMatrixDown(t);return this.fillNoneTiles(e)}expandMatrixRight(t){return t.map((e,r)=>{const i=e.slice();return i.shift(),i.push(_.TILE_TYPES.NONE),i})}expandMatrixLeft(t){return t.map((e,r)=>{const i=e.slice();return i.pop(),i.unshift(_.TILE_TYPES.NONE),i})}expandMatrixUp(t){const e=[];return t.forEach((r,i)=>{i<this.currentMatrixWidth()-1&&e.push(r.slice())}),e.unshift(this.newRow(this.currentMatrixWidth())),e}expandMatrixDown(t){const e=[];return t.forEach((r,i)=>{i>0&&e.push(r.slice())}),e.push(this.newRow(this.currentMatrixWidth())),e}expandedRow(t,e){const r=[];return e.forEach((i,c)=>{r.push(e[c]),r.length<t&&r.push(_.TILE_TYPES.NONE)}),r}newRow(t){return Array(t).fill(_.TILE_TYPES.NONE)}fillNoneTiles(t){const e=[];return t.forEach((r,i)=>{const c=[];r.forEach((l,m)=>{let p=l;if(l===_.TILE_TYPES.NONE){const n=this.getTilesInNeighboringPositions(m,i,t).filter(a=>![_.TILE_TYPES.NONE].includes(a)),s=It(n);s!==_.TILE_TYPES.NONE?p=s:p=_.TILE_TYPES.sample()}c.push(p)}),e.push(c)}),e}getTilesInNeighboringPositions(t,e,r){const i=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1},{x:-1,y:-1},{x:1,y:1},{x:1,y:-1},{x:-1,y:1}],c=[];return i.forEach(l=>{const m=this.getTileAtPosition(t+l.x,e+l.y,r);m&&c.push(m)}),c}getTileAtPosition(t,e,r){try{return r[e][t]}catch{return!1}}}class Yt{constructor({tileSize:t=1,theme:e=_.THEME.DEFAULT,maxZoom:r=10,maxScroll:i=64}){this._tileSize=t,this.theme=e,this.maxZoom=r,this.maxScroll=i,this._world=this.initializeWorld()}get world(){return this._world}set world(t){this._world=t}get tileSize(){return this._tileSize}set tileSize(t){this._tileSize=t}draw(){return this.world.draw(this.tileSize)}initializeWorld(){return new kt({theme:_.THEME[this.theme],maxZoom:this.maxZoom,maxScroll:this.maxScroll})}}class zt{constructor(t){this.running=!1,this.display=t,this.promptOutput=null}get world(){return this.display.world}run(){return[this.display.draw(),this.showKeyPrompts()].join(`\r
`)}onKeypress(t){this.handleDefaultKeypress(t)}handleDefaultKeypress(t){const e=t.key,r=t.code;this.getKeyMap()[e]&&this.getKeyMap()[e](),this.getKeyMap()[r]&&this.getKeyMap()[r]()}prompt(t){return window.prompt(t)}getKeyMap(){const t=this.world;return{r:t.regenerate.bind(t),z:t.zoomIn.bind(t),x:t.zoomOut.bind(t),n:this.nameWorld.bind(this),e:()=>this.exportToTxt(this.world,this.display),p:()=>this.exportToPNG(this.world,this.display),ArrowUp:t.scrollUp.bind(t),ArrowDown:t.scrollDown.bind(t),ArrowRight:t.scrollRight.bind(t),ArrowLeft:t.scrollLeft.bind(t)}}showKeyPrompts(){return["","-----------------------","r to generate new world",this.world.scrollable()?"arrow keys to explore":"","z to zoom in","x to zoom out","n to rename this world","e to save this world in text","p to save this world as image",""].join(`\r
`)}nameWorld(){const t=this.prompt("what do people call this world?");this.world.setName(t)}defaultAction(){return!0}createFileName(t,e="txt"){const r=new Date;return`${r.getFullYear()}_${(r.getMonth()+1).toString().padStart(2,"0")}_${r.getDate().toString().padStart(2,"0")}__${r.getHours().toString().padStart(2,"0")}${r.getMinutes().toString().padStart(2,"0")}${r.getSeconds().toString().padStart(2,"0")}_${t.name.replace(/\s+/g,"_")}.${e}`}exportToTxt(t,e){const r=t.draw(e.tileSize),i=this.createFileName(t),c=new Blob([r],{type:"text/plain"}),l=URL.createObjectURL(c),m=document.createElement("a");m.href=l,m.download=i,m.textContent="Download File",document.body.appendChild(m),m.click(),document.body.removeChild(m),window.alert(`Successfully saved to ${i}`)}exportToPNG(t,e){const i=t.draw(e.tileSize).split(/\r?\n/),c=document.createElement("canvas"),l=11,m=l,p=20,o=t.worldNameDisplay().length*l,n=Math.max(o,i[0].length*l*.6)+p*2,s=i.length*m+p*2;c.width=n,c.height=s;const a=c.getContext("2d");this.renderToCanvas(a,i,c.width,c.height,l,m,p);const d=c.toDataURL("image/png"),f=this.createFileName(t,"png"),u=document.createElement("a");u.href=d,u.download=f,u.textContent="Download Image",document.body.appendChild(u),u.click(),document.body.removeChild(u),window.alert(`Successfully saved to ${f}`)}renderToCanvas(t,e,r,i,c=11,l=20,m=0){t.font=`${c}px monospace`,t.textBaseline="top";const p=document.documentElement,o=getComputedStyle(p).getPropertyValue("--color-bg");t.fillStyle=o,t.fillRect(0,0,r,i);const n=getComputedStyle(p).getPropertyValue("--color-output");t.fillStyle=n,e.forEach((s,a)=>{t.fillText(s,m,m+a*l)})}}class Ot{explore({tileSize:t=1,theme:e="DEFAULT",maxZoom:r=10,maxScroll:i=64}){const c=new Yt({tileSize:t,theme:e,maxZoom:r,maxScroll:i});return{engine:new zt(c),display:c}}}const{document:ut}=Lt;function Zt(x){let t,e,r,i="This is a javascript port of my earlier Ruby World Generator, which was packaged as a ruby gem. This implementation is a web app for the browser, and uses the same world generation algorithms as the original.",c,l,m,p,o;return{c(){t=rt(),e=q("div"),r=q("div"),r.textContent=i,c=rt(),l=q("div"),m=yt(x[0]),this.h()},l(n){Et("svelte-1icwu7a",ut.head).forEach(X),t=it(n),e=J(n,"DIV",{class:!0});var a=nt(e);r=J(a,"DIV",{class:!0,style:!0,"data-svelte-h":!0}),Nt(r)!=="svelte-1eb5mkr"&&(r.textContent=i),c=it(a),l=J(a,"DIV",{class:!0});var d=nt(l);m=bt(d,x[0]),d.forEach(X),a.forEach(X),this.h()},h(){ut.title="World in Your Terminal",Q(r,"class","output"),St(r,"margin-bottom","1rem"),Q(l,"class","output map svelte-1fd3hqt"),Q(e,"class","terminal")},m(n,s){st(n,t,s),st(n,e,s),$(e,r),$(e,c),$(e,l),$(l,m),p||(o=At(window,"keydown",x[1]),p=!0)},p(n,[s]){s&1&&_t(m,n[0])},i:et,o:et,d(n){n&&(X(t),X(e)),p=!1,o()}}}function Dt(x,t,e){let r="",i;vt(()=>{const{engine:l}=new Ot().explore({tileSize:1,maxZoom:10});i=l,e(0,r=l.run())});function c(l){i.onKeypress(l),e(0,r=i.run())}return[r,c]}class Ct extends Mt{constructor(t){super(),Tt(this,t,Dt,Zt,wt,{})}}export{Ct as component};
