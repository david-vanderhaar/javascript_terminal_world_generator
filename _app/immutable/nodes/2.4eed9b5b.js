import{s as Ze,n as ge,r as Ve,o as Ke,i as je}from"../chunks/scheduler.e108d1fd.js";import{S as Xe,i as Ue,s as Q,g as Z,m as te,e as ve,y as Fe,f as _,c as J,h as V,j as re,n as ne,z as Re,k as K,l as $e,A as we,a as C,x as Y,B as ue,o as me,C as Be}from"../chunks/index.d4f55f52.js";const Ge=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ye(i){return(i==null?void 0:i.length)!==void 0?i:Array.from(i)}var w={};function fe(){var i=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(i=!0)}(navigator.userAgent||navigator.vendor||window.opera),i}function xe(){if(fe()){var i=window.innerWidth,e=window.innerHeight,t=Math.min(i,e),n=Math.max(i,e);return t<=480&&n<=896}else return!1}function qe(){return w.DevicePointingAccuracy==null&&(G(),!oe()&&!w.waitingForLoaded&&(w.waitingForLoaded=!0,window.addEventListener("DOMContentLoaded",G))),w.DeviceCanHover}function H(i){var e=window.matchMedia||window.webkitMatchmedia||window.mozMatchmedia||window.oMatchmedia;return e!=null&&e(i).matches}function oe(){return document.readyState==="interactive"||document.readyState==="complete"}function pe(){return w.AppRunsOnLegacyTouchDevice==null&&(w.AppRunsOnLegacyTouchDevice=!H("(pointer:fine)")&&!H("(pointer:coarse)")&&!H("-moz-touch-enabled")&&("ontouchstart"in Window||(navigator.maxTouchPoints||0)>0||/touch|android|iphone|ipod|ipad/i.test(navigator.userAgent))),w.AppRunsOnLegacyTouchDevice}function Qe(i,e){return typeof i.item=="function"?i.item(e):i[e]}function Je(i,e){for(var t=0,n=i.length;t<n;t++)if(e.test(Qe(i,t)))return!0;return!1}function De(){if(!w.MediaQueriesHaveBeenRewritten&&pe())if(oe()){for(var i=document.styleSheets,e=0,t=i.length;e<t;e++)for(var n=i[e].cssRules||i[e].rules,r=0,c=n.length;r<c;r++){var s=n[r];if(s.type===CSSRule.MEDIA_RULE&&Je(s.media,/handheld/i)){var u=s.media;u.mediaText=u.mediaText.replace("handheld","screen")}}for(var g=document.getElementsByTagName("link"),e=0,t=g.length;e<t;e++){var o=g[e];/handheld/i.test(o.media)&&(o.media=o.media.replace("handheld","screen"))}w.MediaQueriesHaveBeenRewritten=!0}else window.addEventListener("DOMContentLoaded",De)}function ie(){return w.DevicePointingAccuracy==null&&(G(),!oe()&&!w.waitingForLoaded&&(w.waitingForLoaded=!0,window.addEventListener("DOMContentLoaded",G))),w.DevicePointingAccuracy}function G(){w.DeviceCanHover=H("(hover:hover)");var i="fine";switch(!0){case H("(pointer:none)"):i="none";break;case H("(pointer:coarse)"):case H("-moz-touch-enabled"):case pe():i="coarse";break}if(w.DevicePointingAccuracy=i,oe()){var e=document.body.classList;if(i==="none"!==e.contains("noPointer")||i==="fine"!==e.contains("finePointer")||i==="coarse"!==e.contains("coarsePointer"))switch(document.body.classList.remove("noPointer","finePointer","coarsePointer"),i){case"none":document.body.classList.add("noPointer");break;case"fine":document.body.classList.add("finePointer");break;case"coarse":document.body.classList.add("coarsePointer");break}}}function Ie(i,e){if(typeof i!="function")throw new Error("handler function expected");w.EventHandlerRegistry==null&&(w.EventHandlerRegistry=[]);for(var t=w.EventHandlerRegistry,n=0,r=t.length;n<r;n++)if(t[n].Handler===i){t[n].onceOnly=e;return}t.push({Handler:i,onceOnly:e}),t.length===1&&rt()}function Oe(i){w.EventHandlerRegistry==null&&(w.EventHandlerRegistry=[]);for(var e=w.EventHandlerRegistry,t=0,n=e.length;t<n;t++)if(e[t].Handler===i){e.splice(t,1);break}e.length===0&&it()}function et(i){Ie(i,!1)}function tt(i){Ie(i,!0)}function nt(i){Oe(i)}function rt(){w.AccuracyPoller=setInterval(function(){var i=ie();G(),ie()!==i&&ot()},500)}function it(){clearInterval(w.AccuracyPoller),w.AccuracyPoller=void 0}function ot(){w.EventHandlerRegistry==null&&(w.EventHandlerRegistry=[]);for(var i=w.EventHandlerRegistry,e=0,t=i.length;e<t;e++){var n=i[e],r=n.Handler,c=n.onceOnly;try{r(ie())}catch(s){console.warn("PointingAccuracy observation function failed with",s)}c&&Oe(r)}}var at={get isMobile(){return fe()},get isPhone(){return xe()},get isTablet(){return fe()&&!xe()},get isLegacyTouchDevice(){return pe()},rewriteMediaQueriesOnLegacyTouchDevices:De,get PointingAccuracy(){return ie()},get canHover(){return qe()},onPointingAccuracyChanged:et,oncePointingAccuracyChanged:tt,offPointingAccuracyChanged:nt,get observesPointingAccuracy(){return w.AccuracyPoller!=null}};const ee={NONE:0,FOREST:1,MOUNTAIN:2,PLAIN:3,WATER:4},p={...ee,sample:()=>{const i=Object.keys(ee).filter(t=>t!==ee.NONE),e=i[Math.floor(Math.random()*i.length)];return ee[e]}},be={[p.NONE]:{character:" ",background:"black",foreground:"white"},[p.WATER]:{character:" ",background:"black",foreground:"white"},[p.FOREST]:{character:"t",background:"black",foreground:"white"},[p.MOUNTAIN]:{character:"M",background:"black",foreground:"white"},[p.PLAIN]:{character:"_",background:"black",foreground:"white"}},st={BLACK_WHITE:be,DEFAULT:be},k={THEME:st,TILE_TYPES:p},Me=["Earth","Solace","Terra","Nova","Solida","Humus","Viridis","Orb","Solo","Lutum","Vita"],Te=["","Red","Green","Blue","Speckled","Spotted"],Ee=["","","","One","Two","Seven"];class lt{generate(){const e=Me[Math.floor(Math.random()*Me.length)],t=Te[Math.floor(Math.random()*Te.length)],n=Ee[Math.floor(Math.random()*Ee.length)];return`${t} ${e} ${n}`.trim()}}var ze={exports:{}};(function(i){(function(e){function t(o){function a(l,m,d){this.x=l,this.y=m,this.z=d}a.prototype.dot2=function(l,m){return this.x*l+this.y*m},a.prototype.dot3=function(l,m,d){return this.x*l+this.y*m+this.z*d},this.grad3=[new a(1,1,0),new a(-1,1,0),new a(1,-1,0),new a(-1,-1,0),new a(1,0,1),new a(-1,0,1),new a(1,0,-1),new a(-1,0,-1),new a(0,1,1),new a(0,-1,1),new a(0,1,-1),new a(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(o||0)}t.prototype.seed=function(o){o>0&&o<1&&(o*=65536),o=Math.floor(o),o<256&&(o|=o<<8);for(var a=this.p,l=0;l<256;l++){var m;l&1?m=a[l]^o&255:m=a[l]^o>>8&255;var d=this.perm,f=this.gradP;d[l]=d[l+256]=m,f[l]=f[l+256]=this.grad3[m%12]}};var n=.5*(Math.sqrt(3)-1),r=(3-Math.sqrt(3))/6,c=1/3,s=1/6;t.prototype.simplex2=function(o,a){var l,m,d,f=(o+a)*n,h=Math.floor(o+f),v=Math.floor(a+f),y=(h+v)*r,x=o-h+y,b=a-v+y,S,T;x>b?(S=1,T=0):(S=0,T=1);var P=x-S+r,E=b-T+r,L=x-1+2*r,M=b-1+2*r;h&=255,v&=255;var N=this.perm,A=this.gradP,R=A[h+N[v]],D=A[h+S+N[v+T]],j=A[h+1+N[v+1]],I=.5-x*x-b*b;I<0?l=0:(I*=I,l=I*I*R.dot2(x,b));var O=.5-P*P-E*E;O<0?m=0:(O*=O,m=O*O*D.dot2(P,E));var z=.5-L*L-M*M;return z<0?d=0:(z*=z,d=z*z*j.dot2(L,M)),70*(l+m+d)},t.prototype.simplex3=function(o,a,l){var m,d,f,h,v=(o+a+l)*c,y=Math.floor(o+v),x=Math.floor(a+v),b=Math.floor(l+v),S=(y+x+b)*s,T=o-y+S,P=a-x+S,E=l-b+S,L,M,N,A,R,D;T>=P?P>=E?(L=1,M=0,N=0,A=1,R=1,D=0):T>=E?(L=1,M=0,N=0,A=1,R=0,D=1):(L=0,M=0,N=1,A=1,R=0,D=1):P<E?(L=0,M=0,N=1,A=0,R=1,D=1):T<E?(L=0,M=1,N=0,A=0,R=1,D=1):(L=0,M=1,N=0,A=1,R=1,D=0);var j=T-L+s,I=P-M+s,O=E-N+s,z=T-A+2*s,ae=P-R+2*s,se=E-D+2*s,le=T-1+3*s,ce=P-1+3*s,he=E-1+3*s;y&=255,x&=255,b&=255;var W=this.perm,q=this.gradP,We=q[y+W[x+W[b]]],Ye=q[y+L+W[x+M+W[b+N]]],Ce=q[y+A+W[x+R+W[b+D]]],He=q[y+1+W[x+1+W[b+1]]],X=.5-T*T-P*P-E*E;X<0?m=0:(X*=X,m=X*X*We.dot3(T,P,E));var U=.5-j*j-I*I-O*O;U<0?d=0:(U*=U,d=U*U*Ye.dot3(j,I,O));var F=.5-z*z-ae*ae-se*se;F<0?f=0:(F*=F,f=F*F*Ce.dot3(z,ae,se));var $=.5-le*le-ce*ce-he*he;return $<0?h=0:($*=$,h=$*$*He.dot3(le,ce,he)),32*(m+d+f+h)};function u(o){return o*o*o*(o*(o*6-15)+10)}function g(o,a,l){return(1-l)*o+l*a}t.prototype.perlin2=function(o,a){var l=Math.floor(o),m=Math.floor(a);o=o-l,a=a-m,l=l&255,m=m&255;var d=this.perm,f=this.gradP,h=f[l+d[m]].dot2(o,a),v=f[l+d[m+1]].dot2(o,a-1),y=f[l+1+d[m]].dot2(o-1,a),x=f[l+1+d[m+1]].dot2(o-1,a-1),b=u(o);return g(g(h,y,b),g(v,x,b),u(a))},t.prototype.perlin3=function(o,a,l){var m=Math.floor(o),d=Math.floor(a),f=Math.floor(l);o=o-m,a=a-d,l=l-f,m=m&255,d=d&255,f=f&255;var h=this.perm,v=this.gradP,y=v[m+h[d+h[f]]].dot3(o,a,l),x=v[m+h[d+h[f+1]]].dot3(o,a,l-1),b=v[m+h[d+1+h[f]]].dot3(o,a-1,l),S=v[m+h[d+1+h[f+1]]].dot3(o,a-1,l-1),T=v[m+1+h[d+h[f]]].dot3(o-1,a,l),P=v[m+1+h[d+h[f+1]]].dot3(o-1,a,l-1),E=v[m+1+h[d+1+h[f]]].dot3(o-1,a-1,l),L=v[m+1+h[d+1+h[f+1]]].dot3(o-1,a-1,l-1),M=u(o),N=u(a),A=u(l);return g(g(g(y,T,M),g(x,P,M),A),g(g(b,E,M),g(S,L,M),A),N)},e.Noise=t})(i.exports)})(ze);var ct=ze.exports;class Pe{twoLandsMatrix(){return[[p.WATER,p.WATER,p.PLAIN,p.FOREST],[p.PLAIN,p.PLAIN,p.WATER,p.PLAIN],[p.FOREST,p.PLAIN,p.WATER,p.WATER],[p.MOUNTAIN,p.FOREST,p.PLAIN,p.WATER]]}waterWorldMatrix(){return[[p.WATER,p.WATER,p.WATER,p.WATER],[p.WATER,p.WATER,p.WATER,p.WATER],[p.WATER,p.WATER,p.WATER,p.WATER],[p.MOUNTAIN,p.WATER,p.WATER,p.WATER]]}noiseMatrix(e,t,n={x:0,y:0,z:0}){const r=new ct.Noise(e),c=[],s=n.x,u=n.y,g=n.z||1;for(let o=0;o<t;o++){const a=[];for(let l=0;l<t;l++){const m=r.simplex2((s+o)*(this.step()/g),(u+l)*this.step()/g),d=this.contrast(m);a.push(this.bar(d))}c.push(a)}return c}step(){return .2}contrast(e){return(e+1)/2}bars(){return[p.WATER,p.WATER,p.PLAIN,p.FOREST,p.MOUNTAIN]}bar(e){const t=this.bars();return t[Math.floor(t.length*e)]}}function de(i,e,t){return Math.min(Math.max(i,e),t)}function Ae(i){return i%2===0}function ht(i){return i[Math.floor(Math.random()*i.length)]}class B{constructor(e,t,n){this.x=e,this.y=t,this.z=n}toString(){return`${this.x},${this.y},${this.z}`}}class dt{constructor({theme:e=k.THEME.BLACK_WHITE,maxScroll:t=64,maxZoom:n=4}){this.theme=e,this._maxXyScroll=t,this._maxZ=n,this.seed=Math.random(),this.regenerate()}regenerate(){this.seed=Math.random(),this.name=this.initializeName(),this.currentPosition=new B(0,0,0),this.matrixMap={[this.currentPosition.toString()]:this.initializeMatrix()}}get matrix(){return this.matrixMap[this.currentPosition.toString()]}getMatrix(){return this.matrixMap[this.currentPosition.toString()]}themedMatrix(e){return this.matrix.map(t=>t.map(n=>e[n].character))}coloredMatrix(){return this.themedMatrix(this.theme)}initializeMatrix(){return new Pe().noiseMatrix(this.seed,4)}initializeName(){return new lt().generate()}setName(e){this.name=e}cycleTheme(){const e=k.THEME.constants.map(r=>k.THEME[r]),n=(e.indexOf(this.theme)+1)%e.length;this.setTheme(e[n])}setTheme(e){this.theme=e}draw(e){return this.renderMapWithInfo(e)}renderMapWithInfo(e){return[this.worldNameDisplay(),this.zoomLevelDisplay(),this.coordinatesDisplay(),"",this.renderMap(e)].join(`\r
`)}renderMap(e){return this.renderMatrix(this.coloredMatrix(),this.theme,e)}renderMatrix(e,t,n){return e.map((r,c)=>r.map((s,u)=>s).join(t[k.TILE_TYPES.NONE].character.repeat(n))).join(`\r
`.repeat(n))}worldNameDisplay(){return`You are exploring _${this.name}_`}zoomLevelDisplay(){return`Zoom: ${this.currentPosition.z}`}coordinatesDisplay(){return`x: ${this.currentPosition.x}, y: ${this.currentPosition.y}`}currentMatrixWidth(){return this.matrix.length}nextMatrixWidth(){return this.currentMatrixWidth()*2-1}matrixExistsInPosition(e){return this.matrixMap.hasOwnProperty(e.toString())}zoomIn(){const e=this.incrementZLevel(this.currentPosition);this.matrixExistsInPosition(e)||this.generateNewZoomedInMap(e),this.currentPosition=e}zoomOut(){const e=this.decrementZLevel(this.currentPosition);this.matrixExistsInPosition(e)||this.generateNewZoomedOutMap(e),this.currentPosition=e}selectMatricesAtXAndZ(e,t){const n={};for(const r in e)this.matrixKeyMatchesXAndZ(r,t.x,t.z)&&(n[r]=e[r]);return n}selectMatricesAtYAndZ(e,t){const n={};for(const r in e)this.matrixKeyMatchesYAndZ(r,t.y,t.z)&&(n[r]=e[r]);return n}matrixKeyMatchesXAndZ(e,t,n){const[r,c,s]=e.split(",").map(Number);return t===r&&n===s}matrixKeyMatchesYAndZ(e,t,n){const[r,c,s]=e.split(",").map(Number);return t===c&&n===s}transformMatrixKeyToPoint(e){const[t,n,r]=e.split(",").map(Number);return new B(t,n,r)}fillMatrixMapWith(e){for(const t of e)this.matrixMap[t.key]=t.value}setCurrentPosition(e){this.currentPosition=e}scrollRight(){this.scrollRightV3()}scrollLeft(){this.scrollLeftV3()}scrollUp(){this.scrollUpV3()}scrollDown(){this.scrollDownV3()}scrollV3(e){const t=e(this.currentPosition);if(!this.matrixExistsInPosition(t)){const n=this.currentMatrixWidth(),r=new Pe().noiseMatrix(this.seed,n,{x:-t.y,y:t.x,z:t.z});this.matrixMap[t.toString()]=r}this.setCurrentPosition(t)}scrollRightV3(){this.scrollV3(this.incrementXLevel.bind(this))}scrollLeftV3(){this.scrollV3(this.decrementXLevel.bind(this))}scrollUpV3(){this.scrollV3(this.incrementYLevel.bind(this))}scrollDownV3(){this.scrollV3(this.decrementYLevel.bind(this))}scrollV2(e,t,n){const r=e(this.currentPosition),u=Object.entries(t(this.matrixMap,this.currentPosition)).map(([g,o])=>{const a=this.transformMatrixKeyToPoint(g),l=e(a);return{key:this.matrixMap[l.toString()]?null:l.toString(),value:n(o)}}).filter(g=>g.key!==null);this.fillMatrixMapWith(u),this.setCurrentPosition(r)}scrollRightV2(){this.scrollV2(this.incrementXLevel.bind(this),this.selectMatricesAtXAndZ.bind(this),this.getMatrixScrolledRight.bind(this))}scrollLeftV2(){this.scrollV2(this.decrementXLevel.bind(this),this.selectMatricesAtXAndZ.bind(this),this.getMatrixScrolledLeft.bind(this))}scrollUpV2(){this.scrollV2(this.incrementYLevel.bind(this),this.selectMatricesAtYAndZ.bind(this),this.getMatrixScrolledUp.bind(this))}scrollDownV2(){this.scrollV2(this.decrementYLevel.bind(this),this.selectMatricesAtYAndZ.bind(this),this.getMatrixScrolledDown.bind(this))}incrementXLevel(e){return this.addToXLevel(1,e)}decrementXLevel(e){return this.addToXLevel(-1,e)}incrementYLevel(e){return this.addToYLevel(1,e)}decrementYLevel(e){return this.addToYLevel(-1,e)}incrementZLevel(e){return this.addToZLevel(1,e)}decrementZLevel(e){return this.addToZLevel(-1,e)}addToXLevel(e,t){const n=de(t.x+e,-this.maxX(),this.maxX());return new B(n,t.y,t.z)}addToYLevel(e,t){const n=de(t.y+e,-this.maxY(),this.maxY());return new B(t.x,n,t.z)}addToZLevel(e,t){const n=de(t.z+e,0,this.maxZ()),r=this.isZoomingOut(e);return new B(r?0:t.x,r?0:t.y,n)}isZoomingOut(e){return e<0}maxX(){return this.scrollable()?this.maxXYScroll():0}maxY(){return this.scrollable()?this.maxXYScroll():0}scrollable(){return!1}maxXYScroll(){return this._maxXyScroll}maxZ(){return this._maxZ}generateNewZoomedInMap(e){const t=this.nextMatrixWidth(),n=[];this.matrix.forEach((c,s)=>{n.push(this.expandedRow(t,this.matrix[s])),n.length<t&&n.push(this.newRow(t))});const r=this.fillNoneTiles(n);this.matrixMap[e.toString()]=r}generateNewZoomedOutMap(e){const t=[];this.matrix.forEach((n,r)=>{if(Ae(r)){const c=[];this.matrix[r].forEach((s,u)=>{Ae(u)&&c.push(s)}),t.push(c)}}),this.matrixMap[e.toString()]=t}getMatrixScrolledRight(e){const t=this.expandMatrixRight(e);return this.fillNoneTiles(t)}getMatrixScrolledLeft(e){const t=this.expandMatrixLeft(e);return this.fillNoneTiles(t)}getMatrixScrolledUp(e){const t=this.expandMatrixUp(e);return this.fillNoneTiles(t)}getMatrixScrolledDown(e){const t=this.expandMatrixDown(e);return this.fillNoneTiles(t)}expandMatrixRight(e){return e.map((t,n)=>{const r=t.slice();return r.shift(),r.push(k.TILE_TYPES.NONE),r})}expandMatrixLeft(e){return e.map((t,n)=>{const r=t.slice();return r.pop(),r.unshift(k.TILE_TYPES.NONE),r})}expandMatrixUp(e){const t=[];return e.forEach((n,r)=>{r<this.currentMatrixWidth()-1&&t.push(n.slice())}),t.unshift(this.newRow(this.currentMatrixWidth())),t}expandMatrixDown(e){const t=[];return e.forEach((n,r)=>{r>0&&t.push(n.slice())}),t.push(this.newRow(this.currentMatrixWidth())),t}expandedRow(e,t){const n=[];return t.forEach((r,c)=>{n.push(t[c]),n.length<e&&n.push(k.TILE_TYPES.NONE)}),n}newRow(e){return Array(e).fill(k.TILE_TYPES.NONE)}fillNoneTiles(e){const t=[];return e.forEach((n,r)=>{const c=[];n.forEach((s,u)=>{let g=s;if(s===k.TILE_TYPES.NONE){const a=this.getTilesInNeighboringPositions(u,r,e).filter(m=>![k.TILE_TYPES.NONE].includes(m)),l=ht(a);l!==k.TILE_TYPES.NONE?g=l:g=k.TILE_TYPES.sample()}c.push(g)}),t.push(c)}),t}getTilesInNeighboringPositions(e,t,n){const r=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1},{x:-1,y:-1},{x:1,y:1},{x:1,y:-1},{x:-1,y:1}],c=[];return r.forEach(s=>{const u=this.getTileAtPosition(e+s.x,t+s.y,n);u&&c.push(u)}),c}getTileAtPosition(e,t,n){try{return n[t][e]}catch{return!1}}}class ut{constructor({tileSize:e=1,theme:t=k.THEME.DEFAULT,maxZoom:n=10,maxScroll:r=64}){this._tileSize=e,this.theme=t,this.maxZoom=n,this.maxScroll=r,this._world=this.initializeWorld()}get world(){return this._world}set world(e){this._world=e}get tileSize(){return this._tileSize}set tileSize(e){this._tileSize=e}draw(){return this.world.draw(this.tileSize)}initializeWorld(){return new dt({theme:k.THEME[this.theme],maxZoom:this.maxZoom,maxScroll:this.maxScroll})}}class mt{constructor(e){this.running=!1,this.display=e,this.promptOutput=null}get world(){return this.display.world}run(){return[this.showKeyPrompts(),this.display.draw(),"","-----------------------","",""].join(`\r
`)}onKeypress(e){return this.handleDefaultKeypress(e)}handleDefaultKeypress(e){const t=e.key,n=e.code;return this.getKeyMap()[t]?(this.getKeyMap()[t](),!0):this.getKeyMap()[n]?(this.getKeyMap()[n](),!0):!1}prompt(e){return window.prompt(e)}getKeyMap(){const e=this.world;return{r:e.regenerate.bind(e),z:e.zoomIn.bind(e),x:e.zoomOut.bind(e),n:this.nameWorld.bind(this),e:()=>this.exportToTxt(this.world,this.display),p:()=>this.exportToPNG(this.world,this.display),ArrowUp:e.scrollUp.bind(e),ArrowDown:e.scrollDown.bind(e),ArrowRight:e.scrollRight.bind(e),ArrowLeft:e.scrollLeft.bind(e)}}getKeymapLabel(e){return{r:"to generate new world",z:"to zoom in",x:"to zoom out",n:"to rename this world",c:"to switch theme",e:"to save this world in text",p:"to save this world as image"}[e]}showKeyPrompts(){return["","r to generate new world",this.world.scrollable()?"arrow keys to explore":"","z to zoom in","x to zoom out","n to rename this world","e to save this world in text","p to save this world as image","-----------------------",""].join(`\r
`)}nameWorld(){const e=this.prompt("what do people call this world?");this.world.setName(e)}defaultAction(){return!0}createFileName(e,t="txt"){const n=new Date;return`${n.getFullYear()}_${(n.getMonth()+1).toString().padStart(2,"0")}_${n.getDate().toString().padStart(2,"0")}__${n.getHours().toString().padStart(2,"0")}${n.getMinutes().toString().padStart(2,"0")}${n.getSeconds().toString().padStart(2,"0")}_${e.name.replace(/\s+/g,"_")}.${t}`}exportToTxt(e,t){const n=e.draw(t.tileSize),r=this.createFileName(e),c=new Blob([n],{type:"text/plain"}),s=URL.createObjectURL(c),u=document.createElement("a");u.href=s,u.download=r,u.textContent="Download File",document.body.appendChild(u),u.click(),document.body.removeChild(u),window.alert(`Successfully saved to ${r}`)}exportToPNG(e,t){const r=e.draw(t.tileSize).split(/\r?\n/),c=document.createElement("canvas"),s=11,u=s,g=20,o=e.worldNameDisplay().length*s,a=Math.max(o,r.at(-1).length*s*.6)+g*2,l=r.length*u+g*2;c.width=a,c.height=l;const m=c.getContext("2d");this.renderToCanvas(m,r,c.width,c.height,s,u,g);const d=c.toDataURL("image/png"),f=this.createFileName(e,"png"),h=document.createElement("a");h.href=d,h.download=f,h.textContent="Download Image",document.body.appendChild(h),h.click(),document.body.removeChild(h),window.alert(`Successfully saved to ${f}`)}renderToCanvas(e,t,n,r,c=11,s=20,u=0){e.font=`${c}px monospace`,e.textBaseline="top";const g=document.documentElement,o=getComputedStyle(g).getPropertyValue("--color-bg");e.fillStyle=o,e.fillRect(0,0,n,r);const a=getComputedStyle(g).getPropertyValue("--color-output");e.fillStyle=a,t.forEach((l,m)=>{e.fillText(l,u,u+m*s)})}}class ft{explore({tileSize:e=1,theme:t="DEFAULT",maxZoom:n=10,maxScroll:r=64}){const c=new ut({tileSize:e,theme:t,maxZoom:n,maxScroll:r});return{engine:new mt(c),display:c}}}const{document:Le}=Ge;function Ne(i,e,t){const n=i.slice();return n[14]=e[t][0],n[15]=e[t][1],n}function ke(i){let e,t=ye(Object.entries(i[1])),n=[];for(let r=0;r<t.length;r+=1)n[r]=_e(Ne(i,t,r));return{c(){e=Z("div");for(let r=0;r<n.length;r+=1)n[r].c();this.h()},l(r){e=V(r,"DIV",{class:!0});var c=re(e);for(let s=0;s<n.length;s+=1)n[s].l(c);c.forEach(_),this.h()},h(){K(e,"class","output output-mobile noSelect svelte-1hva3la")},m(r,c){C(r,e,c);for(let s=0;s<n.length;s+=1)n[s]&&n[s].m(e,null)},p(r,c){if(c&2){t=ye(Object.entries(r[1]));let s;for(s=0;s<t.length;s+=1){const u=Ne(r,t,s);n[s]?n[s].p(u,c):(n[s]=_e(u),n[s].c(),n[s].m(e,null))}for(;s<n.length;s+=1)n[s].d(1);n.length=t.length}},d(r){r&&_(e),Be(n,r)}}}function _e(i){let e,t=i[14]+"",n,r,c=i[15].label+"",s,u,g;return{c(){e=Z("button"),n=te(t),r=te(": "),s=te(c),this.h()},l(o){e=V(o,"BUTTON",{class:!0});var a=re(e);n=ne(a,t),r=ne(a,": "),s=ne(a,c),a.forEach(_),this.h()},h(){K(e,"class","svelte-1hva3la")},m(o,a){C(o,e,a),Y(e,n),Y(e,r),Y(e,s),u||(g=ue(e,"click",function(){je(i[15].handle)&&i[15].handle.apply(this,arguments)}),u=!0)},p(o,a){i=o,a&2&&t!==(t=i[14]+"")&&me(n,t),a&2&&c!==(c=i[15].label+"")&&me(s,c)},d(o){o&&_(e),u=!1,g()}}}function Se(i){let e,t='<button class="start-button crt-flicker svelte-1hva3la">click to initialize</button>';return{c(){e=Z("div"),e.innerHTML=t,this.h()},l(n){e=V(n,"DIV",{class:!0,"data-svelte-h":!0}),Re(e)!=="svelte-1barctm"&&(e.innerHTML=t),this.h()},h(){K(e,"class","full-screen-overlay svelte-1hva3la")},m(n,r){C(n,e,r)},d(n){n&&_(e)}}}function pt(i){let e,t,n,r,c,s,u,g="This is a javascript port of my earlier Ruby World Generator, which was packaged as a ruby gem. This implementation is a web app for the browser, and uses the same world generation algorithms as the original.",o,a,l,m,d=i[0]&&ke(i),f=i[2]&&!i[0]&&Se();return{c(){e=Q(),t=Z("div"),d&&d.c(),n=Q(),r=Z("div"),c=te(i[4]),s=Q(),u=Z("div"),u.textContent=g,o=Q(),f&&f.c(),a=ve(),this.h()},l(h){Fe("svelte-1icwu7a",Le.head).forEach(_),e=J(h),t=V(h,"DIV",{class:!0});var y=re(t);d&&d.l(y),n=J(y),r=V(y,"DIV",{class:!0});var x=re(r);c=ne(x,i[4]),x.forEach(_),s=J(y),u=V(y,"DIV",{class:!0,style:!0,"data-svelte-h":!0}),Re(u)!=="svelte-1eb5mkr"&&(u.textContent=g),y.forEach(_),o=J(h),f&&f.l(h),a=ve(),this.h()},h(){Le.title="World in Your Terminal",K(r,"class","output map svelte-1hva3la"),K(u,"class","output"),$e(u,"margin-bottom","1rem"),K(t,"class","terminal svelte-1hva3la"),we(t,"crt-flicker",i[3])},m(h,v){C(h,e,v),C(h,t,v),d&&d.m(t,null),Y(t,n),Y(t,r),Y(r,c),Y(t,s),Y(t,u),C(h,o,v),f&&f.m(h,v),C(h,a,v),l||(m=[ue(window,"keydown",i[5]),ue(window,"click",i[6])],l=!0)},p(h,[v]){h[0]?d?d.p(h,v):(d=ke(h),d.c(),d.m(t,n)):d&&(d.d(1),d=null),v&16&&me(c,h[4]),v&8&&we(t,"crt-flicker",h[3]),h[2]&&!h[0]?f||(f=Se(),f.c(),f.m(a.parentNode,a)):f&&(f.d(1),f=null)},i:ge,o:ge,d(h){h&&(_(e),_(t),_(o),_(a)),d&&d.d(),f&&f.d(h),l=!1,Ve(m)}}}function gt(i){i.target.classList.add("crt-flicker"),setTimeout(()=>{i.target.classList.remove("crt-flicker")},300)}function vt(i,e){return i.split(`
`).slice(e).join(`
`)}function wt(i,e,t){let n,r="",c,s={},u,g=!0;Ke(()=>{const{engine:f}=new ft().explore({tileSize:1,maxZoom:8});c=f,t(7,r=f.run()),t(1,s=o(c.getKeyMap())),t(0,u=at.isMobile)});function o(f){const h={};return Object.entries(f).forEach(([v])=>{const y=c.getKeymapLabel(v);y&&(h[v]={label:y,handle:x=>{gt(x),a({key:v})}})}),h}function a(f){const h=c.onKeypress(f);t(7,r=c.run()),h&&d()}let l=!1;function m(){g&&t(2,g=!1),d()}function d(){t(3,l=!0),setTimeout(()=>{t(3,l=!1)},300)}return i.$$.update=()=>{i.$$.dirty&129&&t(4,n=vt(r,u?8:1))},[u,s,g,l,n,a,m,r]}class bt extends Xe{constructor(e){super(),Ue(this,e,wt,pt,Ze,{})}}export{bt as component};
