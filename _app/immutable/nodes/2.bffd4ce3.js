import{s as Et,n as ot,o as _t}from"../chunks/scheduler.e108d1fd.js";import{S as yt,i as Nt,s as rt,g as j,m as U,y as Pt,f as z,c as it,h as C,j as st,z as at,n as F,k as $,l as At,a as lt,x as R,A as Lt,o as St}from"../chunks/index.f2815fed.js";const Rt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,q={NONE:0,FOREST:1,MOUNTAIN:2,PLAIN:3,WATER:4},l={...q,sample:()=>{const g=Object.keys(q).filter(e=>e!==q.NONE),t=g[Math.floor(Math.random()*g.length)];return q[t]}},ht={[l.NONE]:{character:" ",background:"black",foreground:"white"},[l.WATER]:{character:" ",background:"black",foreground:"white"},[l.FOREST]:{character:"t",background:"black",foreground:"white"},[l.MOUNTAIN]:{character:"M",background:"black",foreground:"white"},[l.PLAIN]:{character:"_",background:"black",foreground:"white"}},bt={BLACK_WHITE:ht,DEFAULT:ht},S={THEME:bt,TILE_TYPES:l},ct=["Earth","Solace","Terra","Nova","Solida","Humus","Viridis","Orb","Solo","Lutum","Vita"],dt=["","Red","Green","Blue","Speckled","Spotted"],ut=["","","","One","Two","Seven"];class It{generate(){const t=ct[Math.floor(Math.random()*ct.length)],e=dt[Math.floor(Math.random()*dt.length)],r=ut[Math.floor(Math.random()*ut.length)];return`${e} ${t} ${r}`.trim()}}var vt={exports:{}};(function(g){(function(t){function e(i){function n(o,a,c){this.x=o,this.y=a,this.z=c}n.prototype.dot2=function(o,a){return this.x*o+this.y*a},n.prototype.dot3=function(o,a,c){return this.x*o+this.y*a+this.z*c},this.grad3=[new n(1,1,0),new n(-1,1,0),new n(1,-1,0),new n(-1,-1,0),new n(1,0,1),new n(-1,0,1),new n(1,0,-1),new n(-1,0,-1),new n(0,1,1),new n(0,-1,1),new n(0,1,-1),new n(0,-1,-1)],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.seed(i||0)}e.prototype.seed=function(i){i>0&&i<1&&(i*=65536),i=Math.floor(i),i<256&&(i|=i<<8);for(var n=this.p,o=0;o<256;o++){var a;o&1?a=n[o]^i&255:a=n[o]^i>>8&255;var c=this.perm,d=this.gradP;c[o]=c[o+256]=a,d[o]=d[o+256]=this.grad3[a%12]}};var r=.5*(Math.sqrt(3)-1),s=(3-Math.sqrt(3))/6,m=1/3,h=1/6;e.prototype.simplex2=function(i,n){var o,a,c,d=(i+n)*r,u=Math.floor(i+d),v=Math.floor(n+d),E=(u+v)*s,f=i-u+E,w=n-v+E,_,T;f>w?(_=1,T=0):(_=0,T=1);var M=f-_+s,N=w-T+s,A=f-1+2*s,y=w-1+2*s;u&=255,v&=255;var L=this.perm,P=this.gradP,b=P[u+L[v]],I=P[u+_+L[v+T]],Z=P[u+1+L[v+1]],W=.5-f*f-w*w;W<0?o=0:(W*=W,o=W*W*b.dot2(f,w));var k=.5-M*M-N*N;k<0?a=0:(k*=k,a=k*k*I.dot2(M,N));var Y=.5-A*A-y*y;return Y<0?c=0:(Y*=Y,c=Y*Y*Z.dot2(A,y)),70*(o+a+c)},e.prototype.simplex3=function(i,n,o){var a,c,d,u,v=(i+n+o)*m,E=Math.floor(i+v),f=Math.floor(n+v),w=Math.floor(o+v),_=(E+f+w)*h,T=i-E+_,M=n-f+_,N=o-w+_,A,y,L,P,b,I;T>=M?M>=N?(A=1,y=0,L=0,P=1,b=1,I=0):T>=N?(A=1,y=0,L=0,P=1,b=0,I=1):(A=0,y=0,L=1,P=1,b=0,I=1):M<N?(A=0,y=0,L=1,P=0,b=1,I=1):T<N?(A=0,y=1,L=0,P=0,b=1,I=1):(A=0,y=1,L=0,P=1,b=1,I=0);var Z=T-A+h,W=M-y+h,k=N-L+h,Y=T-P+2*h,B=M-b+2*h,J=N-I+2*h,Q=T-1+3*h,tt=M-1+3*h,et=N-1+3*h;E&=255,f&=255,w&=255;var O=this.perm,G=this.gradP,wt=G[E+O[f+O[w]]],gt=G[E+A+O[f+y+O[w+L]]],Mt=G[E+P+O[f+b+O[w+I]]],Tt=G[E+1+O[f+1+O[w+1]]],X=.5-T*T-M*M-N*N;X<0?a=0:(X*=X,a=X*X*wt.dot3(T,M,N));var D=.5-Z*Z-W*W-k*k;D<0?c=0:(D*=D,c=D*D*gt.dot3(Z,W,k));var K=.5-Y*Y-B*B-J*J;K<0?d=0:(K*=K,d=K*K*Mt.dot3(Y,B,J));var V=.5-Q*Q-tt*tt-et*et;return V<0?u=0:(V*=V,u=V*V*Tt.dot3(Q,tt,et)),32*(a+c+d+u)};function p(i){return i*i*i*(i*(i*6-15)+10)}function x(i,n,o){return(1-o)*i+o*n}e.prototype.perlin2=function(i,n){var o=Math.floor(i),a=Math.floor(n);i=i-o,n=n-a,o=o&255,a=a&255;var c=this.perm,d=this.gradP,u=d[o+c[a]].dot2(i,n),v=d[o+c[a+1]].dot2(i,n-1),E=d[o+1+c[a]].dot2(i-1,n),f=d[o+1+c[a+1]].dot2(i-1,n-1),w=p(i);return x(x(u,E,w),x(v,f,w),p(n))},e.prototype.perlin3=function(i,n,o){var a=Math.floor(i),c=Math.floor(n),d=Math.floor(o);i=i-a,n=n-c,o=o-d,a=a&255,c=c&255,d=d&255;var u=this.perm,v=this.gradP,E=v[a+u[c+u[d]]].dot3(i,n,o),f=v[a+u[c+u[d+1]]].dot3(i,n,o-1),w=v[a+u[c+1+u[d]]].dot3(i,n-1,o),_=v[a+u[c+1+u[d+1]]].dot3(i,n-1,o-1),T=v[a+1+u[c+u[d]]].dot3(i-1,n,o),M=v[a+1+u[c+u[d+1]]].dot3(i-1,n,o-1),N=v[a+1+u[c+1+u[d]]].dot3(i-1,n-1,o),A=v[a+1+u[c+1+u[d+1]]].dot3(i-1,n-1,o-1),y=p(i),L=p(n),P=p(o);return x(x(x(E,T,y),x(f,M,y),P),x(x(w,N,y),x(_,A,y),P),L)},t.Noise=e})(g.exports)})(vt);var Wt=vt.exports;class kt{twoLandsMatrix(){return[[l.WATER,l.WATER,l.PLAIN,l.FOREST],[l.PLAIN,l.PLAIN,l.WATER,l.PLAIN],[l.FOREST,l.PLAIN,l.WATER,l.WATER],[l.MOUNTAIN,l.FOREST,l.PLAIN,l.WATER]]}waterWorldMatrix(){return[[l.WATER,l.WATER,l.WATER,l.WATER],[l.WATER,l.WATER,l.WATER,l.WATER],[l.WATER,l.WATER,l.WATER,l.WATER],[l.MOUNTAIN,l.WATER,l.WATER,l.WATER]]}noiseMatrix(t,e,r={x:0,y:0}){const s=new Wt.Noise(t),m=[],h=r.x,p=r.y;for(let x=0;x<e;x++){const i=[];for(let n=0;n<e;n++){const o=s.simplex2((h+x)*this.step(),(p+n)*this.step()),a=this.contrast(o);i.push(this.bar(a))}m.push(i)}return m}step(){return .2}contrast(t){return(t+1)/2}bars(){return[l.WATER,l.WATER,l.PLAIN,l.FOREST,l.MOUNTAIN]}bar(t){const e=this.bars();return e[Math.floor(e.length*t)]}}function nt(g,t,e){return Math.min(Math.max(g,t),e)}function mt(g){return g%2===0}function Yt(g){return g[Math.floor(Math.random()*g.length)]}class H{constructor(t,e,r){this.x=t,this.y=e,this.z=r}toString(){return`${this.x},${this.y},${this.z}`}}class Ot{constructor({theme:t=S.THEME.BLACK_WHITE,maxScroll:e=64,maxZoom:r=4}){this.theme=t,this._maxXyScroll=e,this._maxZ=r,this.regenerate()}regenerate(){this.name=this.initializeName(),this.currentPosition=new H(0,0,0),this.matrixMap={[this.currentPosition.toString()]:this.initializeMatrix()}}get matrix(){return this.matrixMap[this.currentPosition.toString()]}getMatrix(){return this.matrixMap[this.currentPosition.toString()]}themedMatrix(t){return this.matrix.map(e=>e.map(r=>t[r].character))}coloredMatrix(){return this.themedMatrix(this.theme)}initializeMatrix(){const t=Math.random();return new kt().noiseMatrix(t,4)}initializeName(){return new It().generate()}setName(t){this.name=t}cycleTheme(){const t=S.THEME.constants.map(s=>S.THEME[s]),r=(t.indexOf(this.theme)+1)%t.length;this.setTheme(t[r])}setTheme(t){this.theme=t}draw(t){return this.renderMapWithInfo(t)}renderMapWithInfo(t){return[this.renderMap(t),"",this.worldNameDisplay(),this.zoomLevelDisplay(),this.coordinatesDisplay()].join(`
`)}renderMap(t){return this.renderMatrix(this.coloredMatrix(),this.theme,t)}renderMatrix(t,e,r){return t.map((s,m)=>s.map((h,p)=>h).join(e[S.TILE_TYPES.NONE].character.repeat(r))).join(`
`.repeat(r))}worldNameDisplay(){return`You are exploring _${this.name}_`}zoomLevelDisplay(){return`Zoom: ${this.currentPosition.z}`}coordinatesDisplay(){return`x: ${this.currentPosition.x}, y: ${this.currentPosition.y}`}currentMatrixWidth(){return this.matrix.length}nextMatrixWidth(){return this.currentMatrixWidth()*2-1}matrixExistsInPosition(t){return this.matrixMap.hasOwnProperty(t.toString())}zoomIn(){const t=this.incrementZLevel(this.currentPosition);this.matrixExistsInPosition(t)||this.generateNewZoomedInMap(t),this.currentPosition=t}zoomOut(){const t=this.decrementZLevel(this.currentPosition);this.matrixExistsInPosition(t)||this.generateNewZoomedOutMap(t),this.currentPosition=t}selectMatricesAtXAndZ(t,e){const r={};for(const s in t)this.matrixKeyMatchesXAndZ(s,e.x,e.z)&&(r[s]=t[s]);return r}selectMatricesAtYAndZ(t,e){const r={};for(const s in t)this.matrixKeyMatchesYAndZ(s,e.y,e.z)&&(r[s]=t[s]);return r}matrixKeyMatchesXAndZ(t,e,r){const[s,m,h]=t.split(",").map(Number);return e===s&&r===h}matrixKeyMatchesYAndZ(t,e,r){const[s,m,h]=t.split(",").map(Number);return e===m&&r===h}transformMatrixKeyToPoint(t){const[e,r,s]=t.split(",").map(Number);return new H(e,r,s)}fillMatrixMapWith(t){for(const e of t)this.matrixMap[e.key]=e.value}setCurrentPosition(t){this.currentPosition=t}scrollRight(){this.scrollRightV2()}scrollLeft(){this.scrollLeftV2()}scrollUp(){this.scrollUpV2()}scrollDown(){this.scrollDownV2()}scrollV2(t,e,r){const s=t(this.currentPosition),p=e(this.matrixMap,this.currentPosition).map(({key:x,value:i})=>{const n=this.transformMatrixKeyToPoint(x),o=t(n);return{key:this.matrixMap[o.toString()]?null:o.toString(),value:r(i)}}).filter(x=>x.key!==null);this.fillMatrixMapWith(p),this.setCurrentPosition(s)}scrollRightV2(){this.scrollV2(this.incrementXLevel,this.select_matricies_at_x_and_z,this.get_matrix_scrolled_right)}scrollLeftV2(){this.scrollV2(this.decrementXLevel,this.select_matricies_at_x_and_z,this.get_matrix_scrolled_left)}scrollUpV2(){this.scrollV2(this.incrementYLevel,this.select_matricies_at_y_and_z,this.get_matrix_scrolled_up)}scrollDownV2(){this.scrollV2(this.decrementYLevel,this.select_matricies_at_y_and_z,this.get_matrix_scrolled_down)}incrementXLevel(t){return this.addToXLevel(1,t)}decrementXLevel(t){return this.addToXLevel(-1,t)}incrementYLevel(t){return this.addToYLevel(1,t)}decrementYLevel(t){return this.addToYLevel(-1,t)}incrementZLevel(t){return this.addToZLevel(1,t)}decrementZLevel(t){return this.addToZLevel(-1,t)}addToXLevel(t,e){const r=nt(e.x+t,-this.maxX(),this.maxX());return new H(r,e.y,e.z)}addToYLevel(t,e){const r=nt(e.y+t,-this.maxY(),this.maxY());return new H(e.x,r,e.z)}addToZLevel(t,e){const r=nt(e.z+t,0,this.maxZ()),s=this.isZoomingOut(t);return new H(s?0:e.x,s?0:e.y,r)}isZoomingOut(t){return t<0}maxX(){return this.scrollable()?this.maxXYScroll():0}maxY(){return this.scrollable()?this.maxXYScroll():0}scrollable(){return this.currentPosition.z>=this.maxZ()}maxXYScroll(){return this._maxXyScroll}maxZ(){return this._maxZ}generateNewZoomedInMap(t){const e=this.nextMatrixWidth(),r=[];this.matrix.forEach((m,h)=>{r.push(this.expandedRow(e,this.matrix[h])),r.length<e&&r.push(this.newRow(e))});const s=this.fillNoneTiles(r);this.matrixMap[t.toString()]=s}generateNewZoomedOutMap(t){const e=[];this.matrix.forEach((r,s)=>{if(mt(s)){const m=[];this.matrix[s].forEach((h,p)=>{mt(p)&&m.push(h)}),e.push(m)}}),this.matrixMap[t.toString()]=e}getMatrixScrolledRight(t){const e=this.expandMatrixRight(t);return this.fillNoneTiles(e)}getMatrixScrolledLeft(t){const e=this.expandMatrixLeft(t);return this.fillNoneTiles(e)}getMatrixScrolledUp(t){const e=this.expandMatrixUp(t);return this.fillNoneTiles(e)}getMatrixScrolledDown(t){const e=this.expandMatrixDown(t);return this.fillNoneTiles(e)}expandMatrixRight(t){return t.map((e,r)=>{const s=e.slice();return s.shift(),s.push(S.TILE_TYPES.NONE),s})}expandMatrixLeft(t){return t.map((e,r)=>{const s=e.slice();return s.pop(),s.unshift(S.TILE_TYPES.NONE),s})}expandMatrixUp(t){const e=[];return t.forEach((r,s)=>{s<this.currentMatrixWidth()-1&&e.push(r.slice())}),e.unshift(this.newRow(this.currentMatrixWidth())),e}expandMatrixDown(t){const e=[];return t.forEach((r,s)=>{s>0&&e.push(r.slice())}),e.push(this.newRow(this.currentMatrixWidth())),e}expandedRow(t,e){const r=[];return e.forEach((s,m)=>{r.push(e[m]),r.length<t&&r.push(S.TILE_TYPES.NONE)}),r}newRow(t){return Array(t).fill(S.TILE_TYPES.NONE)}fillNoneTiles(t){const e=[];return t.forEach((r,s)=>{const m=[];r.forEach((h,p)=>{let x=h;if(h===S.TILE_TYPES.NONE){const n=this.getTilesInNeighboringPositions(p,s,t).filter(a=>![S.TILE_TYPES.NONE].includes(a)),o=Yt(n);o!==S.TILE_TYPES.NONE?x=o:x=S.TILE_TYPES.sample()}m.push(x)}),e.push(m)}),e}getTilesInNeighboringPositions(t,e,r){const s=[{x:-1,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:1},{x:-1,y:-1},{x:1,y:1},{x:1,y:-1},{x:-1,y:1}],m=[];return s.forEach(h=>{const p=this.getTileAtPosition(t+h.x,e+h.y,r);p&&m.push(p)}),m}getTileAtPosition(t,e,r){try{return r[e][t]}catch{return!1}}}class zt{constructor({tileSize:t=1,theme:e=S.THEME.DEFAULT,maxZoom:r=10,maxScroll:s=64}){this._tileSize=t,this.theme=e,this.maxZoom=r,this.maxScroll=s,this._world=this.initializeWorld()}get world(){return this._world}set world(t){this._world=t}get tileSize(){return this._tileSize}set tileSize(t){this._tileSize=t}draw(){return this.world.draw(this.tileSize)}initializeWorld(){return new Ot({theme:S.THEME[this.theme],maxZoom:this.maxZoom,maxScroll:this.maxScroll})}}class Zt{constructor(t){this.running=!1,this.display=t}get world(){return this.display.world}run(){return[this.display.draw(),this.showKeyPrompts()].join(`
`)}getKeyMap(){return{r:this.world.regenerate.bind(this.world),z:this.world.zoomIn.bind(this.world),x:this.world.zoomOut.bind(this.world),c:this.world.cycleTheme.bind(this.world)}}keyPrompter(t){const e=t.key,r=t.code;this.getKeyMap()[e]&&this.getKeyMap()[e](),this.getKeyMap()[r]&&this.getKeyMap()[r]()}showKeyPrompts(){return["","-----------------------","r to generate new world",this.world.scrollable?"arrow keys to explore":"","z to zoom in","x to zoom out",""].join(`
`)}defaultAction(){return!0}}class Xt{explore({tileSize:t=1,theme:e="DEFAULT",maxZoom:r=10,maxScroll:s=64}){const m=new zt({tileSize:t,theme:e,maxZoom:r,maxScroll:s});return{engine:new Zt(m),display:m}}}const{document:pt}=Rt;function Dt(g){let t,e,r,s="This is a javascript port of my earlier Ruby World Generator, which was packaged as a ruby gem. This implementation is a web app for the browser, and uses the same world generation algorithms as the original.",m,h,p,x,i,n,o,a,c,d,u="◐",v,E;return{c(){t=rt(),e=j("div"),r=j("div"),r.textContent=s,m=rt(),h=j("div"),p=U(g[0]),x=rt(),i=j("p"),n=U(ft),o=U("@"),a=U(xt),c=U(`:
    `),d=j("span"),d.textContent=u,this.h()},l(f){Pt("svelte-1icwu7a",pt.head).forEach(z),t=it(f),e=C(f,"DIV",{class:!0});var _=st(e);r=C(_,"DIV",{class:!0,style:!0,"data-svelte-h":!0}),at(r)!=="svelte-1eb5mkr"&&(r.textContent=s),m=it(_),h=C(_,"DIV",{class:!0});var T=st(h);p=F(T,g[0]),T.forEach(z),x=it(_),i=C(_,"P",{class:!0});var M=st(i);n=F(M,ft),o=F(M,"@"),a=F(M,xt),c=F(M,`:
    `),d=C(M,"SPAN",{class:!0,"data-svelte-h":!0}),at(d)!=="svelte-1382558"&&(d.textContent=u),M.forEach(z),_.forEach(z),this.h()},h(){pt.title="World in Your Terminal",$(r,"class","output"),At(r,"margin-bottom","1rem"),$(h,"class","output map svelte-1fd3hqt"),$(d,"class","terminal-cursor svelte-1fd3hqt"),$(i,"class","prompt"),$(e,"class","terminal")},m(f,w){lt(f,t,w),lt(f,e,w),R(e,r),R(e,m),R(e,h),R(h,p),R(e,x),R(e,i),R(i,n),R(i,o),R(i,a),R(i,c),R(i,d),v||(E=Lt(window,"keydown",g[1]),v=!0)},p(f,[w]){w&1&&St(p,f[0])},i:ot,o:ot,d(f){f&&(z(t),z(e)),v=!1,E()}}}let ft="world",xt="terminal";function Kt(g,t,e){let r="",s,m;_t(()=>{const{engine:p}=new Xt().explore({tileSize:1,maxZoom:10});m=p,s=p.keyPrompter.bind(p),e(0,r=p.run())});function h(p){s(p),e(0,r=m.run())}return[r,h]}class Ut extends yt{constructor(t){super(),Nt(this,t,Kt,Dt,Et,{})}}export{Ut as component};
